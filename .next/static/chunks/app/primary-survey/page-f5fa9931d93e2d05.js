(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[489],{7991:function(e,a,s){Promise.resolve().then(s.bind(s,4958))},4958:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return m},runtime:function(){return h}});var t=s(7437),n=s(9376),i=s(2265),l=s(3278),r=s(1923),o=s(8310),c=s(459),d=s(8029),u=s(1028);let h="edge";function m(){let e=(0,n.useSearchParams)(),a=(0,n.useRouter)(),h=(null==e?void 0:e.get("id"))||"",m=(null==e?void 0:e.get("fleetId"))||"",[p,v]=(0,i.useState)([]),[b,f]=(0,i.useState)("A"),[x,y]=(0,i.useState)(!1),[j,N]=(0,i.useState)(!1),[g,C]=(0,i.useState)(!1),[S,w]=(0,i.useState)(!1),[P,k]=(0,i.useState)(!1),[A,L]=(0,i.useState)({}),[R,T]=(0,i.useState)(!1),[F,I]=(0,i.useState)({title:"",message:""}),[O,E]=(0,i.useState)(""),[_,q]=(0,i.useState)(""),[D,U]=(0,i.useState)(""),[Y,V]=(0,i.useState)(""),[Z,G]=(0,i.useState)(""),[H,J]=(0,i.useState)("");(0,i.useEffect)(()=>{h&&f((0,r.Q2)(h))},[h]),(0,i.useEffect)(()=>{if(h){let e=localStorage.getItem("primary_survey_".concat(h));if(e)try{let a=JSON.parse(e);a.clinicalStatus&&E(a.clinicalStatus),a.responsiveness&&q(a.responsiveness),a.airway&&U(a.airway),a.breathing&&V(a.breathing),a.circulation&&G(a.circulation),a.bloodLoss&&J(a.bloodLoss)}catch(e){console.error("Failed to load saved primary survey:",e)}}},[h]),(0,i.useEffect)(()=>{h&&localStorage.setItem("primary_survey_".concat(h),JSON.stringify({clinicalStatus:O,responsiveness:_,airway:D,breathing:Y,circulation:Z,bloodLoss:H}))},[h,O,_,D,Y,Z,H]);let M=async()=>{T(!0);try{let e=await (0,r.Gf)(h,m);e.success?(N(!1),I({title:"ePRF Submitted Successfully!",message:"The ePRF for Patient ".concat(b," has been submitted.\n\nA PDF copy has been downloaded to your device and the record has been saved.")}),w(!0)):e.validationResult&&(N(!1),L(e.validationResult.fieldErrors),v(e.validationResult.incompleteSections),C(!0))}catch(e){console.error("Submit error:",e),alert("An error occurred while submitting. Please try again.")}finally{T(!1)}},B=async()=>{T(!0);try{let e=await (0,r.mb)(h);e.success?(y(!1),f(e.newLetter),I({title:"Patient Added Successfully!",message:"Patient ".concat(b," has been saved.\n\nYou are now working on Patient ").concat(e.newLetter,".\n\nThe form has been cleared for the new patient.")}),w(!0),setTimeout(()=>{let e=new URLSearchParams({id:h,fleetId:m});a.push("/patient-info?".concat(e))},2e3)):alert(e.error||"Failed to add patient")}catch(e){console.error("Add patient error:",e),alert("An error occurred. Please try again.")}finally{T(!1)}},Q=e=>p.includes("primary-survey")&&("clinicalStatus"===e&&!O||"responsiveness"===e&&!_||"airway"===e&&!D||"breathing"===e&&!Y||"circulation"===e&&!Z||"bloodLoss"===e&&!H),z=()=>{let e=new URLSearchParams({fleetId:m});a.push("/dashboard?".concat(e))},K=e=>{let s=new URLSearchParams({id:h,fleetId:m});"incident"===e?a.push("/incident?".concat(s)):"patient-info"===e?a.push("/patient-info?".concat(s)):"primary-survey"===e?a.push("/primary-survey?".concat(s)):"vital-obs"===e?a.push("/vital-obs?".concat(s)):"hx-complaint"===e?a.push("/hx-complaint?".concat(s)):"past-medical-history"===e?a.push("/past-medical-history?".concat(s)):"clinical-impression"===e?a.push("/clinical-impression?".concat(s)):"disposition"===e?a.push("/disposition?".concat(s)):"media"===e&&a.push("/media?".concat(s))};return(0,t.jsxs)("div",{className:"eprf-dashboard incident-page",children:[(0,t.jsxs)("div",{className:"eprf-nav",children:[(0,t.jsx)("button",{className:"nav-btn",onClick:z,children:"Home"}),(0,t.jsx)("button",{className:"nav-btn",children:"Tools"}),(0,t.jsx)("button",{className:"nav-btn",onClick:()=>{let e=(0,d.ts)();e&&(0,u.GJ)(e.discordId)&&a.push("/admin")},children:"Admin Panel"}),(0,t.jsx)("button",{className:"nav-btn",onClick:()=>{a.push("/")},children:"Manage Crew"}),(0,t.jsxs)("div",{className:"page-counter",children:[(0,t.jsx)("span",{className:"patient-letter",children:b}),(0,t.jsx)("span",{className:"page-indicator",children:"1 of 1"})]})]}),(0,t.jsxs)("div",{className:"incident-layout",children:[(0,t.jsxs)("aside",{className:"sidebar",children:[(0,t.jsx)("button",{className:"sidebar-btn".concat(p.includes("incident")?" incomplete":""),onClick:()=>K("incident"),children:"Incident Information"}),(0,t.jsx)("button",{className:"sidebar-btn".concat(p.includes("patient-info")?" incomplete":""),onClick:()=>K("patient-info"),children:"Patient Information"}),(0,t.jsx)("button",{className:"sidebar-btn active".concat(p.includes("primary-survey")?" incomplete":""),children:"Primary Survey"}),(0,t.jsx)("button",{className:"sidebar-btn".concat(p.includes("vital-obs")?" incomplete":""),onClick:()=>K("vital-obs"),children:"Vital Obs / Treat"}),(0,t.jsx)("button",{className:"sidebar-btn".concat(p.includes("hx-complaint")?" incomplete":""),onClick:()=>K("hx-complaint"),children:"Hx Complaint"}),(0,t.jsx)("button",{className:"sidebar-btn".concat(p.includes("past-medical-history")?" incomplete":""),onClick:()=>K("past-medical-history"),children:"Past Medical History"}),(0,t.jsx)("button",{className:"sidebar-btn".concat(p.includes("clinical-impression")?" incomplete":""),onClick:()=>K("clinical-impression"),children:"Clinical Impression"}),(0,t.jsx)("button",{className:"sidebar-btn".concat(p.includes("disposition")?" incomplete":""),onClick:()=>K("disposition"),children:"Disposition"}),(0,t.jsx)("button",{className:"sidebar-btn",onClick:()=>K("media"),children:"Media"})]}),(0,t.jsx)("main",{className:"incident-content",children:(0,t.jsxs)("section",{className:"incident-section",children:[(0,t.jsx)("h2",{className:"section-title",children:"Primary Survey"}),(0,t.jsx)("div",{className:"form-row",children:(0,t.jsxs)("div",{className:"form-field full-width",children:[(0,t.jsx)("label",{className:"field-label required ".concat(Q("clinicalStatus")?"validation-error-label":""),children:"Clinical Status at Scene"}),(0,t.jsxs)("div",{className:"survey-options ".concat(Q("clinicalStatus")?"validation-error-radio":""),children:[(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"clinicalStatus",value:"0",checked:"0"===O,onChange:e=>E(e.target.value)}),"0"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"clinicalStatus",value:"1",checked:"1"===O,onChange:e=>E(e.target.value)}),"1"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"clinicalStatus",value:"2",checked:"2"===O,onChange:e=>E(e.target.value)}),"2"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"clinicalStatus",value:"3",checked:"3"===O,onChange:e=>E(e.target.value)}),"3"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"clinicalStatus",value:"4",checked:"4"===O,onChange:e=>E(e.target.value)}),"4"]})]})]})}),(0,t.jsx)("div",{className:"form-row",children:(0,t.jsxs)("div",{className:"form-field full-width",children:[(0,t.jsx)("label",{className:"field-label required ".concat(Q("responsiveness")?"validation-error-label":""),children:"Responsiveness"}),(0,t.jsxs)("div",{className:"survey-options ".concat(Q("responsiveness")?"validation-error-radio":""),children:[(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"responsiveness",value:"Alert",checked:"Alert"===_,onChange:e=>q(e.target.value)}),"Alert"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"responsiveness",value:"Voice",checked:"Voice"===_,onChange:e=>q(e.target.value)}),"Voice"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"responsiveness",value:"Pain",checked:"Pain"===_,onChange:e=>q(e.target.value)}),"Pain"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"responsiveness",value:"Unresponsive",checked:"Unresponsive"===_,onChange:e=>q(e.target.value)}),"Unresponsive"]})]})]})}),(0,t.jsx)("div",{className:"form-row",children:(0,t.jsxs)("div",{className:"form-field full-width",children:[(0,t.jsx)("label",{className:"field-label required ".concat(Q("airway")?"validation-error-label":""),children:"Airway"}),(0,t.jsxs)("div",{className:"survey-options ".concat(Q("airway")?"validation-error-radio":""),children:[(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"airway",value:"Patent (Clear)",checked:"Patent (Clear)"===D,onChange:e=>U(e.target.value)}),"Patent (Clear)"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"airway",value:"Partially obstructed",checked:"Partially obstructed"===D,onChange:e=>U(e.target.value)}),"Partially obstructed"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"airway",value:"Obstructed",checked:"Obstructed"===D,onChange:e=>U(e.target.value)}),"Obstructed"]})]})]})}),(0,t.jsx)("div",{className:"form-row",children:(0,t.jsxs)("div",{className:"form-field full-width",children:[(0,t.jsx)("label",{className:"field-label required ".concat(Q("breathing")?"validation-error-label":""),children:"Breathing"}),(0,t.jsxs)("div",{className:"survey-options ".concat(Q("breathing")?"validation-error-radio":""),children:[(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"breathing",value:"Effective",checked:"Effective"===Y,onChange:e=>V(e.target.value)}),"Effective"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"breathing",value:"Ineffective",checked:"Ineffective"===Y,onChange:e=>V(e.target.value)}),"Ineffective"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"breathing",value:"Absent",checked:"Absent"===Y,onChange:e=>V(e.target.value)}),"Absent"]})]})]})}),(0,t.jsx)("div",{className:"form-row",children:(0,t.jsxs)("div",{className:"form-field full-width",children:[(0,t.jsx)("label",{className:"field-label required ".concat(Q("circulation")?"validation-error-label":""),children:"Circulation"}),(0,t.jsxs)("div",{className:"survey-options ".concat(Q("circulation")?"validation-error-radio":""),children:[(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"circulation",value:"Normal",checked:"Normal"===Z,onChange:e=>G(e.target.value)}),"Normal"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"circulation",value:"Compromised",checked:"Compromised"===Z,onChange:e=>G(e.target.value)}),"Compromised"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"circulation",value:"Absent",checked:"Absent"===Z,onChange:e=>G(e.target.value)}),"Absent"]})]})]})}),(0,t.jsx)("div",{className:"form-row",children:(0,t.jsxs)("div",{className:"form-field full-width",children:[(0,t.jsx)("label",{className:"field-label required ".concat(Q("bloodLoss")?"validation-error-label":""),children:"Blood Loss"}),(0,t.jsxs)("div",{className:"survey-options ".concat(Q("bloodLoss")?"validation-error-radio":""),children:[(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"bloodLoss",value:"Nil",checked:"Nil"===H,onChange:e=>J(e.target.value)}),"Nil"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"bloodLoss",value:"Not life threatening",checked:"Not life threatening"===H,onChange:e=>J(e.target.value)}),"Not life threatening"]}),(0,t.jsxs)("label",{className:"survey-option",children:[(0,t.jsx)("input",{type:"radio",name:"bloodLoss",value:"Life threatening",checked:"Life threatening"===H,onChange:e=>J(e.target.value)}),"Life threatening"]})]})]})})]})})]}),(0,t.jsxs)("div",{className:"eprf-footer incident-footer",children:[(0,t.jsxs)("div",{className:"footer-left",children:[(0,t.jsx)("button",{className:"footer-btn internet",children:"Internet"}),(0,t.jsx)("button",{className:"footer-btn server",children:"Server"}),(0,t.jsx)("button",{className:"footer-btn green",onClick:()=>{y(!0)},children:"Add Patient"}),(0,t.jsx)("button",{className:"footer-btn green",onClick:()=>{k(!0)},children:"Transfer ePRF"}),(0,t.jsx)("button",{className:"footer-btn green",onClick:()=>{let e=(0,l.Zl)(h);v(e.incompleteSections),e.isValid?N(!0):(L(e.fieldErrors),C(!0))},children:"Submit ePRF"})]}),(0,t.jsxs)("div",{className:"footer-right",children:[(0,t.jsx)("button",{className:"footer-btn orange",onClick:()=>{K("patient-info")},children:"< Previous"}),(0,t.jsx)("button",{className:"footer-btn orange",onClick:()=>{K("vital-obs")},children:"Next >"})]})]}),(0,t.jsx)(o.ZP,{isOpen:x,onClose:()=>y(!1),onConfirm:B,title:"Add New Patient",message:"Are you sure you want to add a new patient?\n\nThis will:\n• Save the current Patient ".concat(b," data\n• Create a new patient record (Patient ").concat(String.fromCharCode(b.charCodeAt(0)+1),")\n• Clear the form for the new patient"),confirmText:"Yes, Add Patient",cancelText:"Cancel",type:"info",isLoading:R}),(0,t.jsx)(o.ZP,{isOpen:j,onClose:()=>N(!1),onConfirm:M,title:"Submit ePRF",message:"Are you sure you want to submit this ePRF?\n\nThis will:\n• Generate a PDF report for Patient ".concat(b,"\n• Save the record to the database\n• Download the PDF to your device"),confirmText:"Yes, Submit ePRF",cancelText:"Cancel",type:"success",isLoading:R}),(0,t.jsx)(o.Yj,{isOpen:g,onClose:()=>C(!1),errors:A,getSectionDisplayName:l.aY}),(0,t.jsx)(o.i_,{isOpen:S,onClose:()=>w(!1),title:F.title,message:F.message}),(0,t.jsx)(c.Z,{isOpen:P,onClose:()=>k(!1),onTransferComplete:e=>{let{transferAllPatients:a}=s(190);a(h,e.discordId,e.callsign),k(!1),I({title:"ePRF Transferred",message:"The ePRF has been transferred to ".concat(e.callsign,". You will be redirected to the dashboard.")}),w(!0),setTimeout(()=>{z()},2e3)},incidentId:h,patientLetter:b})]})}}},function(e){e.O(0,[505,125,914,973,12,971,30,744],function(){return e(e.s=7991)}),_N_E=e.O()}]);