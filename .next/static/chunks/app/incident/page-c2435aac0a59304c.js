(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82],{8263:function(e,a,t){Promise.resolve().then(t.bind(t,8318))},8318:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return x},runtime:function(){return p}});var n=t(7437),s=t(9376),i=t(2265),l=t(3278),c=t(1923),r=t(8310),o=t(459),d=t(190),m=t(8029),u=t(1028);let p="edge",h=[{value:"MED",label:"MED",desc:"Medical"},{value:"ACC",label:"ACC",desc:"Trauma"},{value:"PTS",label:"PTS",desc:"Patient Transport"},{value:"PVT",label:"PVT",desc:"",disabled:!0},{value:"NO_EPRF",label:"No ePRF",desc:""}],b=[{label:"Home",disabled:!1},{label:"Farm",disabled:!1},{label:"Road",disabled:!1},{label:"Workplace",disabled:!1},{label:"Educational Facility",disabled:!0},{label:"Footpath",disabled:!1},{label:"Aged Care Facility",disabled:!0},{label:"Healthcare Facility",disabled:!1},{label:"Public (Other)",disabled:!1},{label:"Other",disabled:!1}];function x(){let e=(0,s.useSearchParams)(),a=(0,s.useRouter)(),p=(null==e?void 0:e.get("id"))||"",x=(null==e?void 0:e.get("fleetId"))||"",[N,j]=(0,i.useState)("MED"),[v,f]=(0,i.useState)(!1),[g,S]=(0,i.useState)(""),[k,y]=(0,i.useState)(""),[C,T]=(0,i.useState)(""),[w,P]=(0,i.useState)(""),[O,D]=(0,i.useState)(""),[F,R]=(0,i.useState)(""),[A,E]=(0,i.useState)(""),[I,L]=(0,i.useState)("River City Hospital"),[M,_]=(0,i.useState)(""),[H,Y]=(0,i.useState)(""),[q,V]=(0,i.useState)(""),[Z,G]=(0,i.useState)(!1),[J,Q]=(0,i.useState)(null),[U,W]=(0,i.useState)(3),[z,B]=(0,i.useState)(12),[K,X]=(0,i.useState)(2025),[$,ee]=(0,i.useState)(18),[ea,et]=(0,i.useState)(55),[en,es]=(0,i.useState)([]),[ei,el]=(0,i.useState)([]),[ec,er]=(0,i.useState)("A"),[eo,ed]=(0,i.useState)(!1),[em,eu]=(0,i.useState)(!1),[ep,eh]=(0,i.useState)(!1),[eb,ex]=(0,i.useState)(!1),[eN,ej]=(0,i.useState)(!1),[ev,ef]=(0,i.useState)({}),[eg,eS]=(0,i.useState)(!1),[ek,ey]=(0,i.useState)({title:"",message:""});(0,i.useEffect)(()=>{if(p){er((0,c.Q2)(p));let e=(0,m.ts)();e&&!(0,d.getEPRFRecord)(p,(0,c.Q2)(p))&&(0,d.createEPRFRecord)(p,(0,c.Q2)(p),e.discordId,e.callsign,x)}},[p,x]),(0,i.useEffect)(()=>{if(p){let e=localStorage.getItem("incident_".concat(p));if(e)try{let a=JSON.parse(e);a.caseType&&j(a.caseType),void 0!==a.exTransfer&&f(a.exTransfer),a.dateTimeOfCall&&S(a.dateTimeOfCall),a.dispatchTime&&y(a.dispatchTime),a.responding&&T(a.responding),a.atScene&&P(a.atScene),a.atPatient&&D(a.atPatient),a.departScene&&R(a.departScene),a.atDestination&&E(a.atDestination),a.destination&&L(a.destination),a.incidentLocation&&_(a.incidentLocation),a.locationType&&Y(a.locationType),a.locationTypeOther&&V(a.locationTypeOther)}catch(e){console.error("Failed to load saved incident data:",e)}}},[p]),(0,i.useEffect)(()=>{p&&localStorage.setItem("incident_".concat(p),JSON.stringify({caseType:N,exTransfer:v,dateTimeOfCall:g,dispatchTime:k,responding:C,atScene:w,atPatient:O,departScene:F,atDestination:A,destination:I,incidentLocation:M,locationType:H,locationTypeOther:q}))},[p,N,v,g,k,C,w,O,F,A,I,M,H,q]);let eC=async()=>{eS(!0);try{let e=await (0,c.Gf)(p,x);e.success?(eu(!1),ey({title:"ePRF Submitted Successfully!",message:"The ePRF for Patient ".concat(ec," has been submitted.\n\nA PDF copy has been downloaded to your device and the record has been saved.")}),ex(!0)):e.validationResult&&(eu(!1),ef(e.validationResult.fieldErrors),es(e.validationResult.incompleteSections),eh(!0))}catch(e){console.error("Submit error:",e),alert("An error occurred while submitting. Please try again.")}finally{eS(!1)}},eT=async()=>{eS(!0);try{let e=await (0,c.mb)(p);e.success?(ed(!1),er(e.newLetter),ey({title:"Patient Added Successfully!",message:"Patient ".concat(ec," has been saved.\n\nYou are now working on Patient ").concat(e.newLetter,".\n\nThe form has been cleared for the new patient.")}),ex(!0),setTimeout(()=>{let e=new URLSearchParams({id:p,fleetId:x});a.push("/patient-info?".concat(e))},2e3)):alert(e.error||"Failed to add patient")}catch(e){console.error("Add patient error:",e),alert("An error occurred. Please try again.")}finally{eS(!1)}},ew=e=>en.includes("incident")&&("caseType"===e&&!N||"dateTimeOfCall"===e&&!g||"incidentLocation"===e&&!M||"locationType"===e&&!H),eP=()=>{let e=new URLSearchParams({fleetId:x});a.push("/dashboard?".concat(e))},eO=e=>{let t=new URLSearchParams({id:p,fleetId:x});"incident"===e?a.push("/incident?".concat(t)):"patient-info"===e?a.push("/patient-info?".concat(t)):"primary-survey"===e?a.push("/primary-survey?".concat(t)):"vital-obs"===e?a.push("/vital-obs?".concat(t)):"hx-complaint"===e?a.push("/hx-complaint?".concat(t)):"past-medical-history"===e?a.push("/past-medical-history?".concat(t)):"clinical-impression"===e?a.push("/clinical-impression?".concat(t)):"disposition"===e?a.push("/disposition?".concat(t)):"media"===e&&a.push("/media?".concat(t))},eD=e=>{let a=new Date,t="".concat(String(a.getDate()).padStart(2,"0"),"/").concat(String(a.getMonth()+1).padStart(2,"0"),"/").concat(a.getFullYear()," ").concat(String(a.getHours()).padStart(2,"0"),":").concat(String(a.getMinutes()).padStart(2,"0"));switch(e){case"dateTimeOfCall":S(t);break;case"dispatchTime":y(t);break;case"responding":T(t);break;case"atScene":P(t);break;case"atPatient":D(t);break;case"departScene":R(t);break;case"atDestination":E(t)}},eF=e=>{Q(e);let a=new Date;W(a.getDate()),B(a.getMonth()+1),X(a.getFullYear()),ee(a.getHours()),et(a.getMinutes()),G(!0)};return(0,n.jsxs)("div",{className:"eprf-dashboard incident-page",children:[(0,n.jsxs)("div",{className:"eprf-nav",children:[(0,n.jsx)("button",{className:"nav-btn",onClick:eP,children:"Home"}),(0,n.jsx)("button",{className:"nav-btn",children:"Tools"}),(0,n.jsx)("button",{className:"nav-btn",onClick:()=>{let e=(0,m.ts)();e&&(0,u.GJ)(e.discordId)&&a.push("/admin")},children:"Admin Panel"}),(0,n.jsx)("button",{className:"nav-btn",onClick:()=>{a.push("/")},children:"Manage Crew"}),(0,n.jsxs)("div",{className:"page-counter",children:[(0,n.jsx)("span",{className:"patient-letter",children:ec}),(0,n.jsx)("span",{className:"page-indicator",children:"1 of 1"})]})]}),(0,n.jsxs)("div",{className:"incident-layout",children:[(0,n.jsxs)("aside",{className:"sidebar",children:[(0,n.jsx)("button",{className:"sidebar-btn active".concat(en.includes("incident")?" incomplete":""),children:"Incident Information"}),(0,n.jsx)("button",{className:"sidebar-btn".concat(en.includes("patient-info")?" incomplete":""),onClick:()=>eO("patient-info"),children:"Patient Information"}),(0,n.jsx)("button",{className:"sidebar-btn".concat(en.includes("primary-survey")?" incomplete":""),onClick:()=>eO("primary-survey"),children:"Primary Survey"}),(0,n.jsx)("button",{className:"sidebar-btn".concat(en.includes("vital-obs")?" incomplete":""),onClick:()=>eO("vital-obs"),children:"Vital Obs / Treat"}),(0,n.jsx)("button",{className:"sidebar-btn".concat(en.includes("hx-complaint")?" incomplete":""),onClick:()=>eO("hx-complaint"),children:"Hx Complaint"}),(0,n.jsx)("button",{className:"sidebar-btn".concat(en.includes("past-medical-history")?" incomplete":""),onClick:()=>eO("past-medical-history"),children:"Past Medical History"}),(0,n.jsx)("button",{className:"sidebar-btn".concat(en.includes("clinical-impression")?" incomplete":""),onClick:()=>eO("clinical-impression"),children:"Clinical Impression"}),(0,n.jsx)("button",{className:"sidebar-btn".concat(en.includes("disposition")?" incomplete":""),onClick:()=>eO("disposition"),children:"Disposition"}),(0,n.jsx)("button",{className:"sidebar-btn",onClick:()=>eO("media"),children:"Media"})]}),(0,n.jsx)("main",{className:"incident-content",children:(0,n.jsxs)("section",{className:"incident-section",children:[(0,n.jsx)("h2",{className:"section-title",children:"Incident Information"}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-field master-incident",children:[(0,n.jsx)("label",{className:"field-label",children:"Master Incident Number"}),(0,n.jsx)("input",{type:"text",value:p,readOnly:!0,disabled:!0,className:"text-input readonly master"})]}),(0,n.jsxs)("div",{className:"form-field case-types",children:[(0,n.jsx)("label",{className:"field-label required ".concat(ew("caseType")?"validation-error-label":""),children:"Case Type"}),(0,n.jsx)("div",{className:"case-type-grid ".concat(ew("caseType")?"validation-error-radio":""),children:h.map(e=>(0,n.jsxs)("label",{className:"case-type-option ".concat(e.disabled?"disabled":""),children:[(0,n.jsx)("input",{type:"radio",name:"caseType",value:e.value,checked:N===e.value,onChange:e=>j(e.target.value),disabled:e.disabled}),(0,n.jsxs)("span",{className:"radio-label",children:[(0,n.jsx)("span",{children:e.label}),e.desc&&(0,n.jsx)("span",{className:"radio-desc",children:e.desc})]})]},e.value))}),(0,n.jsx)("div",{style:{marginTop:"10px"},children:(0,n.jsxs)("label",{className:"case-type-option disabled",children:[(0,n.jsx)("input",{type:"checkbox",checked:v,onChange:e=>f(e.target.checked),disabled:!0}),(0,n.jsx)("span",{className:"radio-label",children:"Ex-Transfer/Event"})]})})]})]}),(0,n.jsxs)("div",{className:"form-row times-row",children:[(0,n.jsxs)("div",{className:"form-field",children:[(0,n.jsx)("label",{className:"field-label required ".concat(ew("dateTimeOfCall")?"validation-error-label":""),children:"Date/Time of Call"}),(0,n.jsxs)("div",{className:"input-with-btn",children:[(0,n.jsx)("input",{type:"text",value:g,onChange:e=>S(e.target.value),onClick:()=>eF("dateTimeOfCall"),className:"text-input ".concat(ew("dateTimeOfCall")?"validation-error":""),readOnly:!0}),(0,n.jsx)("button",{className:"now-btn",onClick:()=>eD("dateTimeOfCall"),children:"Now"})]})]}),(0,n.jsxs)("div",{className:"form-field",children:[(0,n.jsx)("label",{className:"field-label",children:"Dispatch Time"}),(0,n.jsxs)("div",{className:"input-with-btn",children:[(0,n.jsx)("input",{type:"text",value:k,onChange:e=>y(e.target.value),onClick:()=>eF("dispatchTime"),className:"text-input",readOnly:!0}),(0,n.jsx)("button",{className:"now-btn",onClick:()=>eD("dispatchTime"),children:"Now"})]})]}),(0,n.jsxs)("div",{className:"form-field",children:[(0,n.jsx)("label",{className:"field-label",children:"Responding"}),(0,n.jsxs)("div",{className:"input-with-btn",children:[(0,n.jsx)("input",{type:"text",value:C,onChange:e=>T(e.target.value),onClick:()=>eF("responding"),className:"text-input",readOnly:!0}),(0,n.jsx)("button",{className:"now-btn",onClick:()=>eD("responding"),children:"Now"})]})]}),(0,n.jsxs)("div",{className:"form-field",children:[(0,n.jsx)("label",{className:"field-label",children:"At Scene"}),(0,n.jsxs)("div",{className:"input-with-btn",children:[(0,n.jsx)("input",{type:"text",value:w,onChange:e=>P(e.target.value),onClick:()=>eF("atScene"),className:"text-input",readOnly:!0}),(0,n.jsx)("button",{className:"now-btn",onClick:()=>eD("atScene"),children:"Now"})]})]})]}),(0,n.jsxs)("div",{className:"form-row times-row",children:[(0,n.jsxs)("div",{className:"form-field",children:[(0,n.jsx)("label",{className:"field-label",children:"At Patient"}),(0,n.jsxs)("div",{className:"input-with-btn",children:[(0,n.jsx)("input",{type:"text",value:O,onChange:e=>D(e.target.value),onClick:()=>eF("atPatient"),className:"text-input",readOnly:!0}),(0,n.jsx)("button",{className:"now-btn",onClick:()=>eD("atPatient"),children:"Now"})]})]}),(0,n.jsxs)("div",{className:"form-field",children:[(0,n.jsx)("label",{className:"field-label",children:"Depart Scene"}),(0,n.jsxs)("div",{className:"input-with-btn",children:[(0,n.jsx)("input",{type:"text",value:F,onChange:e=>R(e.target.value),onClick:()=>eF("departScene"),className:"text-input",readOnly:!0}),(0,n.jsx)("button",{className:"now-btn",onClick:()=>eD("departScene"),children:"Now"})]})]}),(0,n.jsxs)("div",{className:"form-field",children:[(0,n.jsx)("label",{className:"field-label",children:"At Destination"}),(0,n.jsxs)("div",{className:"input-with-btn",children:[(0,n.jsx)("input",{type:"text",value:A,onChange:e=>E(e.target.value),onClick:()=>eF("atDestination"),className:"text-input",readOnly:!0}),(0,n.jsx)("button",{className:"now-btn",onClick:()=>eD("atDestination"),children:"Now"})]})]}),(0,n.jsxs)("div",{className:"form-field",children:[(0,n.jsx)("label",{className:"field-label",children:"Destination"}),(0,n.jsx)("input",{type:"text",value:I,readOnly:!0,disabled:!0,className:"text-input readonly preset"})]})]}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsxs)("div",{className:"form-field full-width",children:[(0,n.jsx)("label",{className:"field-label required ".concat(ew("incidentLocation")?"validation-error-label":""),children:"Incident Location"}),(0,n.jsx)("input",{type:"text",value:M,onChange:e=>_(e.target.value),className:"text-input ".concat(ew("incidentLocation")?"validation-error":"")})]})}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsxs)("div",{className:"form-field full-width",children:[(0,n.jsx)("label",{className:"field-label required ".concat(ew("locationType")?"validation-error-label":""),children:"Location Type"}),(0,n.jsx)("div",{className:"location-type-grid ".concat(ew("locationType")?"validation-error-radio":""),children:b.map(e=>(0,n.jsxs)("label",{className:"location-type-option".concat(e.disabled?" disabled":""),children:[(0,n.jsx)("input",{type:"radio",name:"locationType",value:e.label,checked:H===e.label,onChange:e=>Y(e.target.value),disabled:e.disabled}),(0,n.jsx)("span",{className:"radio-label",children:e.label})]},e.label))}),"Other"===H&&(0,n.jsx)("input",{type:"text",className:"text-input",style:{marginTop:"10px"},placeholder:"Please specify...",value:q,onChange:e=>V(e.target.value)})]})})]})})]}),(0,n.jsxs)("div",{className:"eprf-footer incident-footer",children:[(0,n.jsxs)("div",{className:"footer-left",children:[(0,n.jsx)("button",{className:"footer-btn internet",children:"Internet"}),(0,n.jsx)("button",{className:"footer-btn server",children:"Server"}),(0,n.jsx)("button",{className:"footer-btn green",onClick:()=>{ed(!0)},children:"Add Patient"}),(0,n.jsx)("button",{className:"footer-btn green",onClick:()=>{ej(!0)},children:"Transfer ePRF"}),(0,n.jsx)("button",{className:"footer-btn green",onClick:()=>{let e=(0,l.Zl)(p);es(e.incompleteSections),e.isValid?eu(!0):(ef(e.fieldErrors),eh(!0))},children:"Submit ePRF"})]}),(0,n.jsxs)("div",{className:"footer-right",children:[(0,n.jsx)("button",{className:"footer-btn orange disabled",disabled:!0,children:"< Previous"}),(0,n.jsx)("button",{className:"footer-btn orange",onClick:()=>eO("patient-info"),children:"Next >"})]})]}),(0,n.jsx)(r.ZP,{isOpen:eo,onClose:()=>ed(!1),onConfirm:eT,title:"Add New Patient",message:"Are you sure you want to add a new patient?\n\nThis will:\n• Save the current Patient ".concat(ec," data\n• Create a new patient record (Patient ").concat(String.fromCharCode(ec.charCodeAt(0)+1),")\n• Clear the form for the new patient"),confirmText:"Yes, Add Patient",cancelText:"Cancel",type:"info",isLoading:eg}),(0,n.jsx)(r.ZP,{isOpen:em,onClose:()=>eu(!1),onConfirm:eC,title:"Submit ePRF",message:"Are you sure you want to submit this ePRF?\n\nThis will:\n• Generate a PDF report for Patient ".concat(ec,"\n• Save the record to the database\n• Download the PDF to your device"),confirmText:"Yes, Submit ePRF",cancelText:"Cancel",type:"success",isLoading:eg}),(0,n.jsx)(r.Yj,{isOpen:ep,onClose:()=>eh(!1),errors:ev,getSectionDisplayName:l.aY}),(0,n.jsx)(r.i_,{isOpen:eb,onClose:()=>ex(!1),title:ek.title,message:ek.message}),(0,n.jsx)(o.Z,{isOpen:eN,onClose:()=>ej(!1),onTransferComplete:e=>{let{transferAllPatients:a}=t(190);a(p,e.discordId,e.callsign),ej(!1),ey({title:"ePRF Transferred",message:"The ePRF has been transferred to ".concat(e.callsign,". You will be redirected to the dashboard.")}),ex(!0),setTimeout(()=>{eP()},2e3)},incidentId:p,patientLetter:ec}),Z&&(0,n.jsx)("div",{className:"modal-overlay",onClick:()=>G(!1),children:(0,n.jsxs)("div",{className:"datetime-picker",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("div",{className:"picker-header",children:"Date/Time of Call"}),(0,n.jsxs)("div",{className:"picker-display",children:["Wed, December ",String(U).padStart(2,"0"),", ",K," ",String($).padStart(2,"0"),":",String(ea).padStart(2,"0")]}),(0,n.jsxs)("div",{className:"picker-controls",children:[(0,n.jsxs)("div",{className:"picker-column",children:[(0,n.jsx)("button",{className:"picker-btn",onClick:()=>W(Math.min(31,U+1)),children:"+"}),(0,n.jsx)("div",{className:"picker-value highlight",children:String(U).padStart(2,"0")}),(0,n.jsx)("button",{className:"picker-btn",onClick:()=>W(Math.max(1,U-1)),children:"-"})]}),(0,n.jsxs)("div",{className:"picker-column",children:[(0,n.jsx)("button",{className:"picker-btn",onClick:()=>B(12===z?1:z+1),children:"+"}),(0,n.jsx)("div",{className:"picker-value",children:String(z).padStart(2,"0")}),(0,n.jsx)("button",{className:"picker-btn",onClick:()=>B(1===z?12:z-1),children:"-"})]}),(0,n.jsxs)("div",{className:"picker-column",children:[(0,n.jsx)("button",{className:"picker-btn",onClick:()=>X(K+1),children:"+"}),(0,n.jsx)("div",{className:"picker-value",children:K}),(0,n.jsx)("button",{className:"picker-btn",onClick:()=>X(Math.max(2e3,K-1)),children:"-"})]}),(0,n.jsxs)("div",{className:"picker-column",children:[(0,n.jsx)("button",{className:"picker-btn",onClick:()=>ee(($+1)%24),children:"+"}),(0,n.jsx)("div",{className:"picker-value",children:String($).padStart(2,"0")}),(0,n.jsx)("button",{className:"picker-btn",onClick:()=>ee(0===$?23:$-1),children:"-"})]}),(0,n.jsxs)("div",{className:"picker-column",children:[(0,n.jsx)("button",{className:"picker-btn",onClick:()=>et((ea+1)%60),children:"+"}),(0,n.jsx)("div",{className:"picker-value",children:String(ea).padStart(2,"0")}),(0,n.jsx)("button",{className:"picker-btn",onClick:()=>et(0===ea?59:ea-1),children:"-"})]})]}),(0,n.jsxs)("div",{className:"picker-actions",children:[(0,n.jsx)("button",{className:"picker-action-btn cancel",onClick:()=>G(!1),children:"Clear"}),(0,n.jsx)("button",{className:"picker-action-btn ok",onClick:()=>{if(J){let e="".concat(String(U).padStart(2,"0"),"/").concat(String(z).padStart(2,"0"),"/").concat(K," ").concat(String($).padStart(2,"0"),":").concat(String(ea).padStart(2,"0"));switch(J){case"dateTimeOfCall":S(e);break;case"dispatchTime":y(e);break;case"responding":T(e);break;case"atScene":P(e);break;case"atPatient":D(e);break;case"departScene":R(e);break;case"atDestination":E(e)}}G(!1)},children:"Set"})]})]})})]})}}},function(e){e.O(0,[505,125,914,973,12,971,30,744],function(){return e(e.s=8263)}),_N_E=e.O()}]);