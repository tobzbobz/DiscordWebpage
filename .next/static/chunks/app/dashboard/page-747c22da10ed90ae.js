(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8376:function(e,t,a){Promise.resolve().then(a.bind(a,1720))},1720:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p},runtime:function(){return x}});var n=a(7437),i=a(29),s=a.n(i),r=a(9376),o=a(2265),b=a(8029),l=a(190),d=a(3291),c=a(8310),f=a(1028);let x="edge";function p(){let e=(0,r.useSearchParams)(),t=(0,r.useRouter)(),a=(null==e?void 0:e.get("fleetId"))||"",[i,x]=(0,o.useState)(null),[p,m]=(0,o.useState)([]),[u,g]=(0,o.useState)(!0),[j,h]=(0,o.useState)(!1),[w,k]=(0,o.useState)("0000"),[y,v]=(0,o.useState)("001"),[N,z]=(0,o.useState)(""),[I,C]=(0,o.useState)("A"),[S,F]=(0,o.useState)(""),[P,D]=(0,o.useState)("all"),[A,R]=(0,o.useState)(""),[L,E]=(0,o.useState)(""),[_,O]=(0,o.useState)(!1),[T,J]=(0,o.useState)(!1),[B,U]=(0,o.useState)(null),[H,M]=(0,o.useState)(!1),G=(0,o.useCallback)(async e=>{g(!0);try{let t=await (0,l.getEPRFHistoryAsync)(e);if("all"!==P&&(t=t.filter(e=>e.status===P)),A){let e=new Date(A).getTime();t=t.filter(t=>new Date(t.createdAt).getTime()>=e)}if(L){let e=new Date(L).getTime()+864e5;t=t.filter(t=>new Date(t.createdAt).getTime()<=e)}if(S.trim()){let e=S.toLowerCase();t=t.filter(t=>t.incidentId.toLowerCase().includes(e)||t.patientLetter.toLowerCase().includes(e)||t.authorCallsign.toLowerCase().includes(e))}let a=(0,l.groupEPRFsByIncident)(t);m(a)}catch(a){console.error("Failed to load ePRF history:",a);let t=(0,l.searchEPRFs)(e,S,{status:P,dateFrom:A||void 0,dateTo:L||void 0});m((0,l.groupEPRFsByIncident)(t))}finally{g(!1)}},[P,A,L,S]);(0,o.useEffect)(()=>{let e=(0,b.ts)();x(e);let t=new Date;z("".concat(t.getFullYear(),"/").concat(String(t.getMonth()+1).padStart(2,"0"),"/").concat(String(t.getDate()).padStart(2,"0"))),e?G(e.discordId):g(!1)},[]),(0,o.useEffect)(()=>{i&&G(i.discordId)},[S,P,A,L,i,G]);let Y=()=>{h(!0)},X=()=>{h(!1)},$=e=>{t.push("/incident?id=".concat(encodeURIComponent(e.incidentId),"&fleetId=").concat(encodeURIComponent(e.fleetId)))},q=e=>{t.push("/incident?id=".concat(encodeURIComponent(e.incidentId),"&fleetId=").concat(encodeURIComponent(e.fleetId),"&viewOnly=true"))},K=e=>{let t=(0,d.kv)(e.incidentId,e.patientLetter);(0,d.NI)(t)},V=e=>{U({incidentId:e.incidentId,patientLetter:e.patientLetter}),J(!0)},W=async()=>{if(B){M(!0);try{await (0,l.deleteEPRFRecordAsync)(B.incidentId,B.patientLetter),i&&await G(i.discordId)}catch(e){console.error("Failed to delete:",e)}finally{M(!1),J(!1),U(null)}}},Z=p.filter(e=>!e.allComplete),Q=p.filter(e=>e.allComplete);return(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 eprf-dashboard home-dashboard",children:[(0,n.jsx)(s(),{id:"4fb797f00be2b17",children:".home-dashboard.jsx-4fb797f00be2b17{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;min-height:100vh;background:#f0f4f8}.dashboard-header.jsx-4fb797f00be2b17{background:-webkit-linear-gradient(315deg,#1a3a5c 0%,#0d2137 100%);background:-moz-linear-gradient(315deg,#1a3a5c 0%,#0d2137 100%);background:-o-linear-gradient(315deg,#1a3a5c 0%,#0d2137 100%);background:linear-gradient(135deg,#1a3a5c 0%,#0d2137 100%);padding:20px 30px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.header-left.jsx-4fb797f00be2b17 h1.jsx-4fb797f00be2b17{color:white;font-size:24px;margin:0 0 5px 0}.header-left.jsx-4fb797f00be2b17 p.jsx-4fb797f00be2b17{color:rgba(255,255,255,.7);font-size:14px;margin:0}.header-right.jsx-4fb797f00be2b17{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:12px}.header-btn.jsx-4fb797f00be2b17{padding:10px 20px;border:none;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s}.btn-new-case.jsx-4fb797f00be2b17{background:#28a745;color:white}.btn-new-case.jsx-4fb797f00be2b17:hover{background:#218838}.btn-admin.jsx-4fb797f00be2b17{background:-webkit-linear-gradient(315deg,#6366f1 0%,#8b5cf6 100%);background:-moz-linear-gradient(315deg,#6366f1 0%,#8b5cf6 100%);background:-o-linear-gradient(315deg,#6366f1 0%,#8b5cf6 100%);background:linear-gradient(135deg,#6366f1 0%,#8b5cf6 100%);color:white;border:none}.btn-admin.jsx-4fb797f00be2b17:hover{background:-webkit-linear-gradient(315deg,#5558e3 0%,#7c4fe0 100%);background:-moz-linear-gradient(315deg,#5558e3 0%,#7c4fe0 100%);background:-o-linear-gradient(315deg,#5558e3 0%,#7c4fe0 100%);background:linear-gradient(135deg,#5558e3 0%,#7c4fe0 100%)}.btn-logout.jsx-4fb797f00be2b17{background:rgba(255,255,255,.1);color:white;border:1px solid rgba(255,255,255,.3)}.btn-logout.jsx-4fb797f00be2b17:hover{background:rgba(255,255,255,.2)}.dashboard-content.jsx-4fb797f00be2b17{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;padding:30px;overflow-y:auto}.filter-bar.jsx-4fb797f00be2b17{background:white;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;padding:20px;margin-bottom:25px;-webkit-box-shadow:0 2px 8px rgba(0,0,0,.08);-moz-box-shadow:0 2px 8px rgba(0,0,0,.08);box-shadow:0 2px 8px rgba(0,0,0,.08)}.filter-row.jsx-4fb797f00be2b17{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:15px;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.search-input.jsx-4fb797f00be2b17{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;min-width:250px;padding:10px 15px;border:1px solid#ddd;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:14px}.filter-select.jsx-4fb797f00be2b17{padding:10px 15px;border:1px solid#ddd;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:14px;min-width:150px}.filter-btn.jsx-4fb797f00be2b17{padding:10px 15px;border:1px solid#ddd;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;background:white;font-size:14px;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:5px}.filter-btn.jsx-4fb797f00be2b17:hover{background:#f5f5f5}.filter-btn.active.jsx-4fb797f00be2b17{background:#e3f2fd;border-color:#06c;color:#06c}.advanced-filters.jsx-4fb797f00be2b17{margin-top:15px;padding-top:15px;border-top:1px solid#eee;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:15px;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.date-filter.jsx-4fb797f00be2b17{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px}.date-filter.jsx-4fb797f00be2b17 label.jsx-4fb797f00be2b17{font-size:13px;color:#666}.date-filter.jsx-4fb797f00be2b17 input.jsx-4fb797f00be2b17{padding:8px 12px;border:1px solid#ddd;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:14px}.clear-filters.jsx-4fb797f00be2b17{color:#06c;background:none;border:none;font-size:13px;cursor:pointer;text-decoration:underline}.section-title.jsx-4fb797f00be2b17{font-size:18px;font-weight:600;color:#1a3a5c;margin-bottom:15px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:10px}.section-title.jsx-4fb797f00be2b17 .count.jsx-4fb797f00be2b17{background:#e0e0e0;padding:3px 10px;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;font-size:13px;font-weight:500}.section-title.incomplete.jsx-4fb797f00be2b17 .count.jsx-4fb797f00be2b17{background:#fff3cd;color:#856404}.section-title.complete.jsx-4fb797f00be2b17 .count.jsx-4fb797f00be2b17{background:#d4edda;color:#155724}.eprf-grid.jsx-4fb797f00be2b17{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px;margin-bottom:40px}.eprf-card.jsx-4fb797f00be2b17{background:white;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;-webkit-box-shadow:0 2px 10px rgba(0,0,0,.08);-moz-box-shadow:0 2px 10px rgba(0,0,0,.08);box-shadow:0 2px 10px rgba(0,0,0,.08);overflow:hidden;-webkit-transition:-webkit-transform.2s,box-shadow.2s;-moz-transition:-moz-transform.2s,box-shadow.2s;-o-transition:-o-transform.2s,box-shadow.2s;transition:-webkit-transform.2s,box-shadow.2s;transition:-moz-transform.2s,box-shadow.2s;transition:-o-transform.2s,box-shadow.2s;transition:transform.2s,box-shadow.2s}.eprf-card.jsx-4fb797f00be2b17:hover{-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-ms-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px);-webkit-box-shadow:0 4px 20px rgba(0,0,0,.12);-moz-box-shadow:0 4px 20px rgba(0,0,0,.12);box-shadow:0 4px 20px rgba(0,0,0,.12)}.card-header.jsx-4fb797f00be2b17{padding:15px 20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.card-header.incomplete.jsx-4fb797f00be2b17{background:-webkit-linear-gradient(315deg,#fff3cd 0%,#ffeeba 100%);background:-moz-linear-gradient(315deg,#fff3cd 0%,#ffeeba 100%);background:-o-linear-gradient(315deg,#fff3cd 0%,#ffeeba 100%);background:linear-gradient(135deg,#fff3cd 0%,#ffeeba 100%);border-bottom:2px solid#ffc107}.card-header.complete.jsx-4fb797f00be2b17{background:-webkit-linear-gradient(315deg,#d4edda 0%,#c3e6cb 100%);background:-moz-linear-gradient(315deg,#d4edda 0%,#c3e6cb 100%);background:-o-linear-gradient(315deg,#d4edda 0%,#c3e6cb 100%);background:linear-gradient(135deg,#d4edda 0%,#c3e6cb 100%);border-bottom:2px solid#28a745}.card-incident-id.jsx-4fb797f00be2b17{font-size:16px;font-weight:700;color:#1a3a5c}.card-status.jsx-4fb797f00be2b17{padding:4px 12px;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;font-size:12px;font-weight:600;text-transform:uppercase}.card-status.incomplete.jsx-4fb797f00be2b17{background:#856404;color:white}.card-status.complete.jsx-4fb797f00be2b17{background:#28a745;color:white}.card-body.jsx-4fb797f00be2b17{padding:20px}.card-patients.jsx-4fb797f00be2b17{margin-bottom:15px}.patient-row.jsx-4fb797f00be2b17{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;padding:10px 12px;background:#f8f9fa;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;margin-bottom:8px}.patient-info.jsx-4fb797f00be2b17{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:10px}.patient-letter.jsx-4fb797f00be2b17{width:28px;height:28px;background:#1a3a5c;color:white;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;font-weight:600;font-size:13px}.patient-status.jsx-4fb797f00be2b17{font-size:12px;padding:2px 8px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.patient-status.incomplete.jsx-4fb797f00be2b17{background:#fff3cd;color:#856404}.patient-status.complete.jsx-4fb797f00be2b17{background:#d4edda;color:#155724}.card-meta.jsx-4fb797f00be2b17{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;font-size:12px;color:#888;margin-bottom:15px}.card-actions.jsx-4fb797f00be2b17{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:10px;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.card-btn.jsx-4fb797f00be2b17{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;min-width:80px;padding:10px 15px;border:none;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:5px}.btn-edit.jsx-4fb797f00be2b17{background:#06c;color:white}.btn-edit.jsx-4fb797f00be2b17:hover{background:#0052a3}.btn-view.jsx-4fb797f00be2b17{background:#6c757d;color:white}.btn-view.jsx-4fb797f00be2b17:hover{background:#5a6268}.btn-download.jsx-4fb797f00be2b17{background:#28a745;color:white}.btn-download.jsx-4fb797f00be2b17:hover{background:#218838}.btn-delete.jsx-4fb797f00be2b17{background:#dc3545;color:white}.btn-delete.jsx-4fb797f00be2b17:hover{background:#c82333}.empty-state.jsx-4fb797f00be2b17{text-align:center;padding:60px 30px;background:white;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;-webkit-box-shadow:0 2px 10px rgba(0,0,0,.08);-moz-box-shadow:0 2px 10px rgba(0,0,0,.08);box-shadow:0 2px 10px rgba(0,0,0,.08)}.empty-icon.jsx-4fb797f00be2b17{font-size:60px;margin-bottom:20px}.empty-title.jsx-4fb797f00be2b17{font-size:20px;font-weight:600;color:#1a3a5c;margin-bottom:10px}.empty-text.jsx-4fb797f00be2b17{font-size:14px;color:#666;margin-bottom:20px}.empty-btn.jsx-4fb797f00be2b17{padding:12px 30px;background:#28a745;color:white;border:none;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:15px;font-weight:600;cursor:pointer}.empty-btn.jsx-4fb797f00be2b17:hover{background:#218838}.multi-patient-warning.jsx-4fb797f00be2b17{background:#fff3cd;border:1px solid#ffc107;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;padding:10px 12px;font-size:12px;color:#856404;margin-bottom:15px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px}.loading-state.jsx-4fb797f00be2b17{text-align:center;padding:60px 30px;background:white;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;-webkit-box-shadow:0 2px 10px rgba(0,0,0,.08);-moz-box-shadow:0 2px 10px rgba(0,0,0,.08);box-shadow:0 2px 10px rgba(0,0,0,.08)}.loading-spinner.jsx-4fb797f00be2b17{width:50px;height:50px;border:4px solid#e0e0e0;border-top-color:#06c;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:spin 1s linear infinite;-moz-animation:spin 1s linear infinite;-o-animation:spin 1s linear infinite;animation:spin 1s linear infinite;margin:0 auto 20px}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{to{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{to{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{to{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}.loading-text.jsx-4fb797f00be2b17{font-size:16px;color:#666}gap: 8px;\r\n        }\r\n      "}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 dashboard-header",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 header-left",children:[(0,n.jsx)("h1",{className:"jsx-4fb797f00be2b17",children:"ePRF Dashboard"}),(0,n.jsxs)("p",{className:"jsx-4fb797f00be2b17",children:["Welcome back, ",(null==i?void 0:i.callsign)||a]})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 header-right",children:[i&&(0,f.GJ)(i.discordId)&&(0,n.jsx)("button",{onClick:()=>t.push("/admin"),className:"jsx-4fb797f00be2b17 header-btn btn-admin",children:"⚙️ Admin Panel"}),(0,n.jsx)("button",{onClick:Y,className:"jsx-4fb797f00be2b17 header-btn btn-new-case",children:"+ New Case"}),(0,n.jsx)("button",{onClick:()=>{t.push("/")},className:"jsx-4fb797f00be2b17 header-btn btn-logout",children:"Logout"})]})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 dashboard-content",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 filter-bar",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 filter-row",children:[(0,n.jsx)("input",{type:"text",placeholder:"Search by incident number, patient letter, or callsign...",value:S,onChange:e=>F(e.target.value),className:"jsx-4fb797f00be2b17 search-input"}),(0,n.jsxs)("select",{value:P,onChange:e=>D(e.target.value),className:"jsx-4fb797f00be2b17 filter-select",children:[(0,n.jsx)("option",{value:"all",className:"jsx-4fb797f00be2b17",children:"All Status"}),(0,n.jsx)("option",{value:"incomplete",className:"jsx-4fb797f00be2b17",children:"Incomplete"}),(0,n.jsx)("option",{value:"complete",className:"jsx-4fb797f00be2b17",children:"Complete"})]}),(0,n.jsx)("button",{onClick:()=>O(!_),className:"jsx-4fb797f00be2b17 "+"filter-btn ".concat(_?"active":""),children:"\uD83D\uDD0D Filters"})]}),_&&(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 advanced-filters",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 date-filter",children:[(0,n.jsx)("label",{className:"jsx-4fb797f00be2b17",children:"From:"}),(0,n.jsx)("input",{type:"date",value:A,onChange:e=>R(e.target.value),className:"jsx-4fb797f00be2b17"})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 date-filter",children:[(0,n.jsx)("label",{className:"jsx-4fb797f00be2b17",children:"To:"}),(0,n.jsx)("input",{type:"date",value:L,onChange:e=>E(e.target.value),className:"jsx-4fb797f00be2b17"})]}),(0,n.jsx)("button",{onClick:()=>{F(""),D("all"),R(""),E("")},className:"jsx-4fb797f00be2b17 clear-filters",children:"Clear all filters"})]})]}),u&&(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 loading-state",children:[(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 loading-spinner"}),(0,n.jsx)("p",{className:"jsx-4fb797f00be2b17 loading-text",children:"Loading ePRF records..."})]}),!u&&Z.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("h2",{className:"jsx-4fb797f00be2b17 section-title incomplete",children:["\uD83D\uDCDD Current ePRFs",(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 count",children:Z.length})]}),(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 eprf-grid",children:Z.map(e=>(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 eprf-card",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 card-header incomplete",children:[(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 card-incident-id",children:e.incidentId}),(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 card-status incomplete",children:"In Progress"})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 card-body",children:[e.patients.length>1&&(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 multi-patient-warning",children:"⚠️ Multi-patient incident - all patients must be completed before submission"}),(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 card-patients",children:e.patients.map(e=>(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 patient-row",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 patient-info",children:[(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 patient-letter",children:e.patientLetter}),(0,n.jsxs)("span",{className:"jsx-4fb797f00be2b17",children:["Patient ",e.patientLetter]})]}),(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 "+"patient-status ".concat(e.status),children:"complete"===e.status?"✓ Complete":"Incomplete"})]},e.patientLetter))}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 card-meta",children:[(0,n.jsxs)("span",{className:"jsx-4fb797f00be2b17",children:["Created: ",new Date(e.createdAt).toLocaleDateString("en-GB")]}),(0,n.jsxs)("span",{className:"jsx-4fb797f00be2b17",children:["Fleet: ",e.fleetId]})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 card-actions",children:[(0,n.jsx)("button",{onClick:()=>$(e.patients[0]),className:"jsx-4fb797f00be2b17 card-btn btn-edit",children:"✏️ Edit"}),(0,n.jsx)("button",{onClick:()=>V(e.patients.find(e=>"incomplete"===e.status)||e.patients[0]),className:"jsx-4fb797f00be2b17 card-btn btn-delete",children:"\uD83D\uDDD1️ Delete"})]})]})]},e.incidentId))})]}),!u&&Q.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("h2",{className:"jsx-4fb797f00be2b17 section-title complete",children:["✅ Completed ePRFs",(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 count",children:Q.length})]}),(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 eprf-grid",children:Q.map(e=>{var t;return(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 eprf-card",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 card-header complete",children:[(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 card-incident-id",children:e.incidentId}),(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 card-status complete",children:"Completed"})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 card-body",children:[(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 card-patients",children:e.patients.map(e=>(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 patient-row",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 patient-info",children:[(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 patient-letter",children:e.patientLetter}),(0,n.jsxs)("span",{className:"jsx-4fb797f00be2b17",children:["Patient ",e.patientLetter]})]}),(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 patient-status complete",children:"✓ Complete"})]},e.patientLetter))}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 card-meta",children:[(0,n.jsxs)("span",{className:"jsx-4fb797f00be2b17",children:["Submitted: ",new Date((null===(t=e.patients[0])||void 0===t?void 0:t.submittedAt)||e.createdAt).toLocaleDateString("en-GB")]}),(0,n.jsxs)("span",{className:"jsx-4fb797f00be2b17",children:["Fleet: ",e.fleetId]})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 card-actions",children:[(0,n.jsx)("button",{onClick:()=>q(e.patients[0]),className:"jsx-4fb797f00be2b17 card-btn btn-view",children:"\uD83D\uDC41️ View"}),e.patients.map(t=>(0,n.jsxs)("button",{onClick:()=>K(t),className:"jsx-4fb797f00be2b17 card-btn btn-download",children:["\uD83D\uDCE5 ",e.patients.length>1?"Pt ".concat(t.patientLetter):"Download"]},t.patientLetter))]})]})]},e.incidentId)})})]}),!u&&0===p.length&&(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 empty-state",children:[(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 empty-icon",children:"\uD83D\uDCCB"}),(0,n.jsx)("h3",{className:"jsx-4fb797f00be2b17 empty-title",children:"No ePRFs Found"}),(0,n.jsx)("p",{className:"jsx-4fb797f00be2b17 empty-text",children:S||"all"!==P||A||L?"No ePRFs match your current filters. Try adjusting your search criteria.":'You haven\'t created any ePRFs yet. Click "New Case" to get started.'}),!S&&"all"===P&&!A&&!L&&(0,n.jsx)("button",{onClick:Y,className:"jsx-4fb797f00be2b17 empty-btn",children:"+ Create New Case"})]})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 eprf-footer",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 footer-left",children:[(0,n.jsx)("button",{className:"jsx-4fb797f00be2b17 footer-btn internet",children:"Internet"}),(0,n.jsx)("button",{className:"jsx-4fb797f00be2b17 footer-btn server",children:"Server"})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 footer-center",children:[(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 fleet-label",children:"Fleet ID:"}),(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 fleet-id",children:a})]}),(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 footer-right",children:(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 version",children:"v 2.19.1"})})]}),j&&(0,n.jsx)("div",{onClick:X,className:"jsx-4fb797f00be2b17 modal-overlay",children:(0,n.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-4fb797f00be2b17 modal-dialog",children:[(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 modal-header",children:"Master Incident Number"}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 modal-body",children:[(0,n.jsx)("div",{className:"jsx-4fb797f00be2b17 modal-section-label",children:"Incident Number"}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 incident-fields",children:[(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 incident-input-group",children:[(0,n.jsx)("input",{type:"number",value:w,onChange:e=>k(e.target.value.slice(0,4).padStart(4,"0")),min:"0",max:"9999",style:{width:"135px"},className:"jsx-4fb797f00be2b17 incident-input"}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 incident-arrows",children:[(0,n.jsx)("button",{onClick:()=>{k(String(Math.min(9999,(parseInt(w)||0)+1)).padStart(4,"0"))},className:"jsx-4fb797f00be2b17 arrow-btn up",children:"▲"}),(0,n.jsx)("button",{onClick:()=>{k(String(Math.max(0,(parseInt(w)||0)-1)).padStart(4,"0"))},className:"jsx-4fb797f00be2b17 arrow-btn down",children:"▼"})]})]}),(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 separator",children:"-"}),(0,n.jsx)("input",{type:"text",value:y,readOnly:!0,disabled:!0,style:{width:"75px",backgroundColor:"#c0d0e0",color:"#556575"},className:"jsx-4fb797f00be2b17 incident-part readonly"}),(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 separator",children:"-"}),(0,n.jsx)("input",{type:"text",value:N,readOnly:!0,disabled:!0,className:"jsx-4fb797f00be2b17 incident-part date readonly"}),(0,n.jsx)("span",{className:"jsx-4fb797f00be2b17 separator",children:"-"}),(0,n.jsx)("input",{type:"text",value:I,readOnly:!0,disabled:!0,className:"jsx-4fb797f00be2b17 incident-part letter readonly"})]})]}),(0,n.jsxs)("div",{className:"jsx-4fb797f00be2b17 modal-actions",children:[(0,n.jsx)("button",{onClick:X,className:"jsx-4fb797f00be2b17 modal-btn cancel",children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>{let e="".concat(w,"-").concat(y,"-").concat(N,"-").concat(I);t.push("/incident?id=".concat(encodeURIComponent(e),"&fleetId=").concat(encodeURIComponent(a))),h(!1)},className:"jsx-4fb797f00be2b17 modal-btn ok",children:"OK"})]})]})}),(0,n.jsx)(c.ZP,{isOpen:T,onClose:()=>J(!1),onConfirm:W,title:"Delete ePRF",message:"Are you sure you want to delete this ePRF?\n\nIncident: ".concat(null==B?void 0:B.incidentId,"\nPatient: ").concat(null==B?void 0:B.patientLetter,"\n\nThis action cannot be undone and all data will be permanently lost."),confirmText:"Yes, Delete",cancelText:"Cancel",type:"warning",isLoading:H})]})}},190:function(e,t,a){"use strict";a.r(t),a.d(t,{areAllPatientsComplete:function(){return I},createEPRFRecord:function(){return f},createEPRFRecordAsync:function(){return c},deleteEPRFRecord:function(){return j},deleteEPRFRecordAsync:function(){return u},getAllEPRFRecords:function(){return b},getBlockedSubmissions:function(){return D},getCompleteEPRFs:function(){return S},getEPRFHistory:function(){return o},getEPRFHistoryAsync:function(){return r},getEPRFRecord:function(){return P},getIncompleteEPRFs:function(){return C},groupEPRFsByIncident:function(){return z},markEPRFComplete:function(){return m},markEPRFCompleteAsync:function(){return x},saveEPRFRecord:function(){return d},saveEPRFRecordLocal:function(){return l},searchEPRFs:function(){return F},searchEPRFsAsync:function(){return N},transferAllPatients:function(){return v},transferAllPatientsAsync:function(){return y},transferEPRF:function(){return k},transferEPRFAsync:function(){return h}});var n=a(1028);let i="eprf_history";function s(e){return{id:"".concat(e.incident_id,"-").concat(e.patient_letter),incidentId:e.incident_id,patientLetter:e.patient_letter,status:e.status,author:e.author_discord_id,authorCallsign:e.author_callsign,createdAt:e.created_at,updatedAt:e.updated_at,submittedAt:e.submitted_at,fleetId:e.fleet_id}}async function r(e){try{let t=(await n.Jf(e)).map(s),a=b().filter(t=>t.author!==e);return localStorage.setItem(i,JSON.stringify([...a,...t])),localStorage.setItem("eprf_cache_timestamp",Date.now().toString()),t}catch(t){return console.error("Failed to fetch from API, using cache:",t),o(e)}}function o(e){try{let t=localStorage.getItem(i);if(!t)return[];return JSON.parse(t).filter(t=>t.author===e)}catch(e){return[]}}function b(){try{let e=localStorage.getItem(i);return e?JSON.parse(e):[]}catch(e){return[]}}function l(e){let t=b(),a=t.findIndex(t=>t.incidentId===e.incidentId&&t.patientLetter===e.patientLetter);a>=0?t[a]={...t[a],...e,updatedAt:new Date().toISOString()}:t.push(e),localStorage.setItem(i,JSON.stringify(t))}async function d(e){l(e);try{await n.ie(e.incidentId,e.patientLetter,e.author,e.authorCallsign,e.fleetId)}catch(e){console.error("Failed to sync to API:",e)}}async function c(e,t,a,i,s){let r=new Date().toISOString(),o={id:"".concat(e,"-").concat(t),incidentId:e,patientLetter:t,status:"incomplete",author:a,authorCallsign:i,createdAt:r,updatedAt:r,fleetId:s};l(o);try{await n.ie(e,t,a,i,s)}catch(e){console.error("Failed to save to API:",e)}return o}function f(e,t,a,i,s){let r=new Date().toISOString(),o={id:"".concat(e,"-").concat(t),incidentId:e,patientLetter:t,status:"incomplete",author:a,authorCallsign:i,createdAt:r,updatedAt:r,fleetId:s};return l(o),n.ie(e,t,a,i,s).catch(e=>console.error("Failed to sync to API:",e)),o}async function x(e,t){p(e,t);try{await n.$h(e,t)}catch(e){console.error("Failed to mark complete via API:",e)}}function p(e,t){let a=b(),n=a.find(a=>a.incidentId===e&&a.patientLetter===t);n&&(n.status="complete",n.submittedAt=new Date().toISOString(),n.updatedAt=new Date().toISOString(),localStorage.setItem(i,JSON.stringify(a)))}function m(e,t){p(e,t),n.$h(e,t).catch(e=>console.error("Failed to sync to API:",e))}async function u(e,t){let a=g(e,t);try{return await n.HX(e,t),!0}catch(e){return console.error("Failed to delete via API:",e),a}}function g(e,t){let a=b(),n=a.find(a=>a.incidentId===e&&a.patientLetter===t);if(n&&"incomplete"===n.status){let n=a.filter(a=>!(a.incidentId===e&&a.patientLetter===t));return localStorage.setItem(i,JSON.stringify(n)),["incident","patient_info","primary_survey","hx_complaint","past_medical_history","clinical_impression","disposition","vitals","medications","interventions","media"].forEach(t=>{localStorage.removeItem("".concat(t,"_").concat(e))}),!0}return!1}function j(e,t){let a=g(e,t);return n.HX(e,t).catch(e=>console.error("Failed to sync delete to API:",e)),a}async function h(e,t,a,i){w(e,t,a,i);try{return await n.F3(e,t,a,i),!0}catch(e){return console.error("Failed to transfer via API:",e),!0}}function w(e,t,a,n){let s=b(),r=s.find(a=>a.incidentId===e&&a.patientLetter===t);return!!r&&(r.author=a,r.authorCallsign=n,r.updatedAt=new Date().toISOString(),localStorage.setItem(i,JSON.stringify(s)),!0)}function k(e,t,a,i){let s=w(e,t,a,i);return n.F3(e,t,a,i).catch(e=>console.error("Failed to sync transfer to API:",e)),s}async function y(e,t,a){let n=b().filter(t=>t.incidentId===e);if(0===n.length)return!1;for(let i of n)await h(e,i.patientLetter,t,a);return!0}function v(e,t,a){let n=b().filter(t=>t.incidentId===e);return 0!==n.length&&(n.forEach(n=>{k(e,n.patientLetter,t,a)}),!0)}async function N(e,t,a){try{return(await n.qx(e,t,a)).map(s)}catch(n){return console.error("Failed to search via API, using local cache:",n),F(e,t||"",{status:a})}}function z(e){let t={};return e.forEach(e=>{t[e.incidentId]||(t[e.incidentId]=[]),t[e.incidentId].push(e)}),Object.entries(t).map(e=>{var t,a;let[n,i]=e;return{incidentId:n,patients:i.sort((e,t)=>e.patientLetter.localeCompare(t.patientLetter)),allComplete:i.every(e=>"complete"===e.status),createdAt:(null===(t=i[0])||void 0===t?void 0:t.createdAt)||"",fleetId:(null===(a=i[0])||void 0===a?void 0:a.fleetId)||""}}).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())}function I(e){let t=b().filter(t=>t.incidentId===e);return t.length>0&&t.every(e=>"complete"===e.status)}function C(e){return o(e).filter(e=>"incomplete"===e.status)}function S(e){return o(e).filter(e=>"complete"===e.status)}function F(e,t,a){let n=o(e);if((null==a?void 0:a.status)&&"all"!==a.status&&(n=n.filter(e=>e.status===a.status)),null==a?void 0:a.dateFrom){let e=new Date(a.dateFrom).getTime();n=n.filter(t=>new Date(t.createdAt).getTime()>=e)}if(null==a?void 0:a.dateTo){let e=new Date(a.dateTo).getTime()+864e5;n=n.filter(t=>new Date(t.createdAt).getTime()<=e)}if(t.trim()){let e=t.toLowerCase();n=n.filter(t=>t.incidentId.toLowerCase().includes(e)||t.patientLetter.toLowerCase().includes(e)||t.authorCallsign.toLowerCase().includes(e))}return n}function P(e,t){return b().find(a=>a.incidentId===e&&a.patientLetter===t)||null}function D(e){return z(o(e)).filter(e=>e.patients.length>1&&!e.allComplete&&e.patients.some(e=>"complete"===e.status))}}},function(e){e.O(0,[505,125,914,973,971,30,744],function(){return e(e.s=8376)}),_N_E=e.O()}]);