(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[990],{4550:function(e,t,i){Promise.resolve().then(i.bind(i,2932))},2932:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return u},runtime:function(){return f}});var a=i(7437),d=i(29),n=i.n(d),s=i(9376),o=i(2265),c=i(3278),r=i(1923),l=i(8310),b=i(459),x=i(8029),m=i(1028);let f="edge";function u(){var e,t,d,f,u,p,h;let j=(0,s.useSearchParams)(),g=(0,s.useRouter)(),v=(null==j?void 0:j.get("id"))||"",w=(null==j?void 0:j.get("fleetId"))||"",[y,k]=(0,o.useState)([]),[N,C]=(0,o.useState)([]),[S,P]=(0,o.useState)(null),[D,z]=(0,o.useState)(!1),R=(0,o.useRef)(null),A=(0,o.useRef)([]),F=(0,o.useRef)(null),[T,L]=(0,o.useState)("A"),[I,E]=(0,o.useState)(!1),[O,U]=(0,o.useState)(!1),[M,_]=(0,o.useState)(!1),[B,G]=(0,o.useState)(!1),[Y,Z]=(0,o.useState)(!1),[H,J]=(0,o.useState)({}),[V,W]=(0,o.useState)(!1),[Q,q]=(0,o.useState)({title:"",message:""});(0,o.useEffect)(()=>{v&&L((0,r.Q2)(v))},[v]),(0,o.useEffect)(()=>{if(v){let e=localStorage.getItem("media_".concat(v));if(e)try{let t=JSON.parse(e);C(t)}catch(e){console.error("Failed to parse saved data:",e)}}},[v]),(0,o.useEffect)(()=>{v&&localStorage.setItem("media_".concat(v),JSON.stringify(N))},[N,v]);let K=()=>{let e=new URLSearchParams({fleetId:w});g.push("/dashboard?".concat(e))},X=e=>{let t=new URLSearchParams({id:v,fleetId:w});"incident"===e?g.push("/incident?".concat(t)):"patient-info"===e?g.push("/patient-info?".concat(t)):"primary-survey"===e?g.push("/primary-survey?".concat(t)):"vital-obs"===e?g.push("/vital-obs?".concat(t)):"hx-complaint"===e?g.push("/hx-complaint?".concat(t)):"past-medical-history"===e?g.push("/past-medical-history?".concat(t)):"clinical-impression"===e?g.push("/clinical-impression?".concat(t)):"disposition"===e?g.push("/disposition?".concat(t)):"media"===e&&g.push("/media?".concat(t))},$=async()=>{W(!0);try{let e=await (0,r.Gf)(v,w);e.success?(U(!1),q({title:"ePRF Submitted Successfully!",message:"The ePRF for Patient ".concat(T," has been submitted.\n\nA PDF copy has been downloaded to your device and the record has been saved.")}),Z(!0)):e.validationResult&&(U(!1),J(e.validationResult.fieldErrors),k(e.validationResult.incompleteSections),G(!0))}catch(e){console.error("Submit error:",e),alert("An error occurred while submitting. Please try again.")}finally{W(!1)}},ee=async()=>{W(!0);try{let e=await (0,r.mb)(v);e.success?(E(!1),L(e.newLetter),q({title:"Patient Added Successfully!",message:"Patient ".concat(T," has been saved.\n\nYou are now working on Patient ").concat(e.newLetter,".\n\nThe form has been cleared for the new patient.")}),Z(!0),setTimeout(()=>{let e=new URLSearchParams({id:v,fleetId:w});g.push("/patient-info?".concat(e))},2e3)):alert(e.error||"Failed to add patient")}catch(e){console.error("Add patient error:",e),alert("An error occurred. Please try again.")}finally{W(!1)}},et=async()=>{if(D){var e;null===(e=R.current)||void 0===e||e.stop(),z(!1)}else try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);R.current=t,A.current=[],t.ondataavailable=e=>{A.current.push(e.data)},t.onstop=()=>{let t=new Blob(A.current,{type:"audio/webm"}),i=new FileReader;i.onload=e=>{var t;let i=null===(t=e.target)||void 0===t?void 0:t.result,a={id:Date.now().toString()+Math.random().toString(36).substr(2,9),type:"audio",name:"Audio Memo ".concat(new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit"})),dataUrl:i,timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})};C(e=>[...e,a])},i.readAsDataURL(t),e.getTracks().forEach(e=>e.stop())},t.start(),z(!0)}catch(e){console.error("Failed to start recording:",e),alert("Could not access microphone. Please check permissions.")}},ei=e=>{P(S===e?null:e)},ea=()=>N.find(e=>e.id===S);return(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e eprf-dashboard incident-page",children:[(0,a.jsx)(n(),{id:"f7dc2dd0b4bab37e",children:".media-section.jsx-f7dc2dd0b4bab37e{padding:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:15px}.media-toolbar.jsx-f7dc2dd0b4bab37e{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:0;background:#d0d4d8;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;border:1px solid#999}.toolbar-btn.jsx-f7dc2dd0b4bab37e{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:5px;padding:15px 25px;background:#e8eaec;border:none;border-right:1px solid#999;cursor:pointer;min-width:100px;font-size:13px;color:#333}.toolbar-btn.jsx-f7dc2dd0b4bab37e:last-child{border-right:none}.toolbar-btn.jsx-f7dc2dd0b4bab37e:hover{background:#d8dade}.toolbar-btn.recording.jsx-f7dc2dd0b4bab37e{background:#fcc}.toolbar-icon.jsx-f7dc2dd0b4bab37e{font-size:24px}.media-container.jsx-f7dc2dd0b4bab37e{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:15px;-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.media-list.jsx-f7dc2dd0b4bab37e{width:320px;min-height:400px;background:#a8b8c8;border:2px solid#7a9cc0;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;padding:10px;overflow-y:auto}.media-item.jsx-f7dc2dd0b4bab37e{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:10px;padding:10px;background:#d0dae4;border:1px solid#7a9cc0;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;margin-bottom:8px;cursor:pointer;-webkit-transition:background.2s;-moz-transition:background.2s;-o-transition:background.2s;transition:background.2s}.media-item.jsx-f7dc2dd0b4bab37e:hover{background:#c0cad4}.media-item.selected.jsx-f7dc2dd0b4bab37e{background:#5080b0;color:white}.media-item-icon.jsx-f7dc2dd0b4bab37e{font-size:20px}.media-item-info.jsx-f7dc2dd0b4bab37e{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;overflow:hidden}.media-item-name.jsx-f7dc2dd0b4bab37e{font-size:13px;font-weight:500;white-space:nowrap;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}.media-item-time.jsx-f7dc2dd0b4bab37e{font-size:11px;opacity:.8}.media-preview.jsx-f7dc2dd0b4bab37e{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;min-height:400px;background:#a8b8c8;border:2px solid#7a9cc0;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:20px}.preview-content.jsx-f7dc2dd0b4bab37e{max-width:100%;max-height:100%}.preview-content.jsx-f7dc2dd0b4bab37e img.jsx-f7dc2dd0b4bab37e{max-width:100%;max-height:350px;-o-object-fit:contain;object-fit:contain}.preview-content.jsx-f7dc2dd0b4bab37e audio.jsx-f7dc2dd0b4bab37e{width:100%;min-width:300px}.preview-content.jsx-f7dc2dd0b4bab37e video.jsx-f7dc2dd0b4bab37e{max-width:100%;max-height:350px}.no-selection.jsx-f7dc2dd0b4bab37e{color:#666;font-size:14px}.hidden-input.jsx-f7dc2dd0b4bab37e{display:none}"}),(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e eprf-nav",children:[(0,a.jsx)("button",{onClick:K,className:"jsx-f7dc2dd0b4bab37e nav-btn",children:"Home"}),(0,a.jsx)("button",{className:"jsx-f7dc2dd0b4bab37e nav-btn",children:"Tools"}),(0,a.jsx)("button",{onClick:()=>{let e=(0,x.ts)();e&&(0,m.GJ)(e.discordId)&&g.push("/admin")},className:"jsx-f7dc2dd0b4bab37e nav-btn",children:"Admin Panel"}),(0,a.jsx)("button",{onClick:()=>{g.push("/")},className:"jsx-f7dc2dd0b4bab37e nav-btn",children:"Manage Crew"}),(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e page-counter",children:[(0,a.jsx)("span",{className:"jsx-f7dc2dd0b4bab37e patient-letter",children:T}),(0,a.jsx)("span",{className:"jsx-f7dc2dd0b4bab37e page-indicator",children:"1 of 1"})]})]}),(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e incident-layout",children:[(0,a.jsxs)("aside",{className:"jsx-f7dc2dd0b4bab37e sidebar",children:[(0,a.jsx)("button",{onClick:()=>X("incident"),className:"jsx-f7dc2dd0b4bab37e "+"sidebar-btn".concat(y.includes("incident")?" incomplete":""),children:"Incident Information"}),(0,a.jsx)("button",{onClick:()=>X("patient-info"),className:"jsx-f7dc2dd0b4bab37e "+"sidebar-btn".concat(y.includes("patient-info")?" incomplete":""),children:"Patient Information"}),(0,a.jsx)("button",{onClick:()=>X("primary-survey"),className:"jsx-f7dc2dd0b4bab37e "+"sidebar-btn".concat(y.includes("primary-survey")?" incomplete":""),children:"Primary Survey"}),(0,a.jsx)("button",{onClick:()=>X("vital-obs"),className:"jsx-f7dc2dd0b4bab37e "+"sidebar-btn".concat(y.includes("vital-obs")?" incomplete":""),children:"Vital Obs / Treat"}),(0,a.jsx)("button",{onClick:()=>X("hx-complaint"),className:"jsx-f7dc2dd0b4bab37e "+"sidebar-btn".concat(y.includes("hx-complaint")?" incomplete":""),children:"Hx Complaint"}),(0,a.jsx)("button",{onClick:()=>X("past-medical-history"),className:"jsx-f7dc2dd0b4bab37e "+"sidebar-btn".concat(y.includes("past-medical-history")?" incomplete":""),children:"Past Medical History"}),(0,a.jsx)("button",{onClick:()=>X("clinical-impression"),className:"jsx-f7dc2dd0b4bab37e "+"sidebar-btn".concat(y.includes("clinical-impression")?" incomplete":""),children:"Clinical Impression"}),(0,a.jsx)("button",{onClick:()=>X("disposition"),className:"jsx-f7dc2dd0b4bab37e "+"sidebar-btn".concat(y.includes("disposition")?" incomplete":""),children:"Disposition"}),(0,a.jsx)("button",{className:"jsx-f7dc2dd0b4bab37e sidebar-btn active",children:"Media"})]}),(0,a.jsx)("main",{className:"jsx-f7dc2dd0b4bab37e incident-content",children:(0,a.jsxs)("section",{className:"jsx-f7dc2dd0b4bab37e incident-section media-section",children:[(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e media-toolbar",children:[(0,a.jsxs)("button",{onClick:()=>{var e;null===(e=F.current)||void 0===e||e.click()},className:"jsx-f7dc2dd0b4bab37e toolbar-btn",children:[(0,a.jsx)("span",{className:"jsx-f7dc2dd0b4bab37e toolbar-icon",children:"\uD83D\uDCC1"}),"Upload Media"]}),(0,a.jsxs)("button",{onClick:et,className:"jsx-f7dc2dd0b4bab37e "+"toolbar-btn ".concat(D?"recording":""),children:[(0,a.jsx)("span",{className:"jsx-f7dc2dd0b4bab37e toolbar-icon",children:"\uD83C\uDFA4"}),D?"Stop Recording":"Record Audio"]}),(0,a.jsxs)("button",{onClick:()=>{S&&(C(e=>e.filter(e=>e.id!==S)),P(null))},disabled:!S,className:"jsx-f7dc2dd0b4bab37e toolbar-btn",children:[(0,a.jsx)("span",{className:"jsx-f7dc2dd0b4bab37e toolbar-icon",children:"\uD83D\uDDD1️"}),"Discard"]})]}),(0,a.jsx)("input",{ref:F,type:"file",accept:"image/*,audio/*,video/*",multiple:!0,onChange:e=>{let t=e.target.files;t&&0!==t.length&&(Array.from(t).forEach(e=>{let t=new FileReader;t.onload=t=>{var i;let a=null===(i=t.target)||void 0===i?void 0:i.result,d="image";e.type.startsWith("audio/")?d="audio":e.type.startsWith("video/")&&(d="video");let n={id:Date.now().toString()+Math.random().toString(36).substr(2,9),type:d,name:e.name,dataUrl:a,timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})};C(e=>[...e,n])},t.readAsDataURL(e)}),e.target.value="")},className:"jsx-f7dc2dd0b4bab37e hidden-input"}),(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e media-container",children:[(0,a.jsx)("div",{className:"jsx-f7dc2dd0b4bab37e media-list",children:N.map(e=>(0,a.jsxs)("div",{onClick:()=>ei(e.id),className:"jsx-f7dc2dd0b4bab37e "+"media-item ".concat(S===e.id?"selected":""),children:[(0,a.jsx)("span",{className:"jsx-f7dc2dd0b4bab37e media-item-icon",children:"image"===e.type?"\uD83D\uDDBC️":"audio"===e.type?"\uD83C\uDFB5":"\uD83C\uDFAC"}),(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e media-item-info",children:[(0,a.jsx)("div",{className:"jsx-f7dc2dd0b4bab37e media-item-name",children:e.name}),(0,a.jsx)("div",{className:"jsx-f7dc2dd0b4bab37e media-item-time",children:e.timestamp})]})]},e.id))}),(0,a.jsx)("div",{className:"jsx-f7dc2dd0b4bab37e media-preview",children:S&&ea()?(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e preview-content",children:[(null===(e=ea())||void 0===e?void 0:e.type)==="image"&&(0,a.jsx)("img",{src:null===(t=ea())||void 0===t?void 0:t.dataUrl,alt:null===(d=ea())||void 0===d?void 0:d.name,className:"jsx-f7dc2dd0b4bab37e"}),(null===(f=ea())||void 0===f?void 0:f.type)==="audio"&&(0,a.jsx)("audio",{controls:!0,src:null===(u=ea())||void 0===u?void 0:u.dataUrl,className:"jsx-f7dc2dd0b4bab37e"}),(null===(p=ea())||void 0===p?void 0:p.type)==="video"&&(0,a.jsx)("video",{controls:!0,src:null===(h=ea())||void 0===h?void 0:h.dataUrl,className:"jsx-f7dc2dd0b4bab37e"})]}):(0,a.jsx)("span",{className:"jsx-f7dc2dd0b4bab37e no-selection",children:"Select media to preview"})})]})]})})]}),(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e eprf-footer incident-footer",children:[(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e footer-left",children:[(0,a.jsx)("button",{className:"jsx-f7dc2dd0b4bab37e footer-btn internet",children:"Internet"}),(0,a.jsx)("button",{className:"jsx-f7dc2dd0b4bab37e footer-btn server",children:"Server"}),(0,a.jsx)("button",{onClick:()=>{E(!0)},className:"jsx-f7dc2dd0b4bab37e footer-btn discovery",children:"Add Patient"}),(0,a.jsx)("button",{onClick:()=>{_(!0)},className:"jsx-f7dc2dd0b4bab37e footer-btn green",children:"Transfer ePRF"}),(0,a.jsx)("button",{onClick:()=>{let e=(0,c.Zl)(v);k(e.incompleteSections),e.isValid?U(!0):(J(e.fieldErrors),G(!0))},className:"jsx-f7dc2dd0b4bab37e footer-btn green",children:"Submit ePRF"})]}),(0,a.jsxs)("div",{className:"jsx-f7dc2dd0b4bab37e footer-right",children:[(0,a.jsx)("button",{onClick:()=>{X("disposition")},className:"jsx-f7dc2dd0b4bab37e footer-btn orange",children:"< Previous"}),(0,a.jsx)("button",{onClick:()=>{},className:"jsx-f7dc2dd0b4bab37e footer-btn orange",children:"Next >"})]})]}),(0,a.jsx)(l.ZP,{isOpen:I,onClose:()=>E(!1),onConfirm:ee,title:"Add New Patient",message:"Are you sure you want to add a new patient?\n\nThis will:\n• Save the current Patient ".concat(T," data\n• Create a new patient record (Patient ").concat(String.fromCharCode(T.charCodeAt(0)+1),")\n• Clear the form for the new patient"),confirmText:"Yes, Add Patient",cancelText:"Cancel",type:"info",isLoading:V}),(0,a.jsx)(l.ZP,{isOpen:O,onClose:()=>U(!1),onConfirm:$,title:"Submit ePRF",message:"Are you sure you want to submit this ePRF?\n\nThis will:\n• Generate a PDF report for Patient ".concat(T,"\n• Save the record to the database\n• Download the PDF to your device"),confirmText:"Yes, Submit ePRF",cancelText:"Cancel",type:"success",isLoading:V}),(0,a.jsx)(l.Yj,{isOpen:B,onClose:()=>G(!1),errors:H,getSectionDisplayName:c.aY}),(0,a.jsx)(l.i_,{isOpen:Y,onClose:()=>Z(!1),title:Q.title,message:Q.message}),(0,a.jsx)(b.Z,{isOpen:M,onClose:()=>_(!1),onTransferComplete:e=>{let{transferAllPatients:t}=i(190);t(v,e.discordId,e.callsign),_(!1),q({title:"ePRF Transferred",message:"The ePRF has been transferred to ".concat(e.callsign,". You will be redirected to the dashboard.")}),Z(!0),setTimeout(()=>{K()},2e3)},incidentId:v,patientLetter:T})]})}}},function(e){e.O(0,[505,125,914,973,12,971,30,744],function(){return e(e.s=4550)}),_N_E=e.O()}]);