{"version":3,"file":"app/api/eprf/records/route.js","mappings":"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","sources":["webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/./app/api/eprf/records/route.js","webpack://_N_E/./app/api/eprf/records/route.js?384f","webpack://_N_E/?3c92","webpack://_N_E/./lib/db.ts"],"sourcesContent":["module.exports = require(\"node:async_hooks\");","module.exports = require(\"node:buffer\");","import { \r\n  createEPRFRecord, \r\n  getEPRFRecord, \r\n  getEPRFRecordsByUser,\r\n  markEPRFComplete,\r\n  deleteEPRFRecord,\r\n  transferEPRF,\r\n  searchEPRFs\r\n} from '../../../../lib/db';\r\n\r\nexport const runtime = 'edge';\r\n\r\n// GET - Fetch ePRF records\r\nexport async function GET(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const discordId = searchParams.get('discordId');\r\n    const incidentId = searchParams.get('incidentId');\r\n    const patientLetter = searchParams.get('patientLetter');\r\n    const query = searchParams.get('query');\r\n    const status = searchParams.get('status');\r\n    \r\n    if (incidentId && patientLetter) {\r\n      // Get specific record\r\n      const record = await getEPRFRecord(incidentId, patientLetter);\r\n      return Response.json({ success: true, record });\r\n    } else if (discordId) {\r\n      // Search/list records for user\r\n      const records = await searchEPRFs(discordId, query, status);\r\n      return Response.json({ success: true, records });\r\n    } else {\r\n      return Response.json({ success: false, error: 'Missing required parameters' }, { status: 400 });\r\n    }\r\n  } catch (error) {\r\n    console.error('GET ePRF error:', error);\r\n    return Response.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST - Create new ePRF record\r\nexport async function POST(request) {\r\n  try {\r\n    const body = await request.json();\r\n    const { incidentId, patientLetter, authorDiscordId, authorCallsign, fleetId } = body;\r\n    \r\n    if (!incidentId || !patientLetter || !authorDiscordId) {\r\n      return Response.json({ success: false, error: 'Missing required fields' }, { status: 400 });\r\n    }\r\n    \r\n    const record = await createEPRFRecord(\r\n      incidentId, \r\n      patientLetter, \r\n      authorDiscordId, \r\n      authorCallsign || 'Unknown',\r\n      fleetId || ''\r\n    );\r\n    \r\n    return Response.json({ success: true, record });\r\n  } catch (error) {\r\n    console.error('POST ePRF error:', error);\r\n    return Response.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT - Update ePRF record (complete, transfer)\r\nexport async function PUT(request) {\r\n  try {\r\n    const body = await request.json();\r\n    const { action, incidentId, patientLetter, newAuthorDiscordId, newAuthorCallsign } = body;\r\n    \r\n    if (!incidentId || !patientLetter || !action) {\r\n      return Response.json({ success: false, error: 'Missing required fields' }, { status: 400 });\r\n    }\r\n    \r\n    let record;\r\n    \r\n    if (action === 'complete') {\r\n      record = await markEPRFComplete(incidentId, patientLetter);\r\n    } else if (action === 'transfer') {\r\n      if (!newAuthorDiscordId || !newAuthorCallsign) {\r\n        return Response.json({ success: false, error: 'Missing transfer target' }, { status: 400 });\r\n      }\r\n      record = await transferEPRF(incidentId, patientLetter, newAuthorDiscordId, newAuthorCallsign);\r\n    } else {\r\n      return Response.json({ success: false, error: 'Invalid action' }, { status: 400 });\r\n    }\r\n    \r\n    return Response.json({ success: true, record });\r\n  } catch (error) {\r\n    console.error('PUT ePRF error:', error);\r\n    return Response.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// DELETE - Delete ePRF record\r\nexport async function DELETE(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const incidentId = searchParams.get('incidentId');\r\n    const patientLetter = searchParams.get('patientLetter');\r\n    \r\n    if (!incidentId || !patientLetter) {\r\n      return Response.json({ success: false, error: 'Missing required parameters' }, { status: 400 });\r\n    }\r\n    \r\n    const deleted = await deleteEPRFRecord(incidentId, patientLetter);\r\n    \r\n    if (deleted) {\r\n      return Response.json({ success: true, message: 'Record deleted' });\r\n    } else {\r\n      return Response.json({ success: false, error: 'Record not found or already completed' }, { status: 404 });\r\n    }\r\n  } catch (error) {\r\n    console.error('DELETE ePRF error:', error);\r\n    return Response.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","import { AppRouteRouteModule } from \"next/dist/server/future/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"C:\\\\Users\\\\Toby\\\\Downloads\\\\node-v24.11.1-win-x64\\\\app123\\\\app\\\\api\\\\eprf\\\\records\\\\route.js\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/eprf/records/route\",\n        pathname: \"/api/eprf/records\",\n        filename: \"route\",\n        bundlePath: \"app/api/eprf/records/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\Toby\\\\Downloads\\\\node-v24.11.1-win-x64\\\\app123\\\\app\\\\api\\\\eprf\\\\records\\\\route.js\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/eprf/records/route\";\nfunction patchFetch() {\n    return _patchFetch({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\nexport { routeModule, requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, originalPathname, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","import { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2Feprf%2Frecords%2Froute&page=%2Fapi%2Feprf%2Frecords%2Froute&pagePath=private-next-app-dir%2Fapi%2Feprf%2Frecords%2Froute.js&appDir=C%3A%5CUsers%5CToby%5CDownloads%5Cnode-v24.11.1-win-x64%5Capp123%5Capp&appPaths=%2Fapi%2Feprf%2Frecords%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!private-next-app-dir/api/eprf/records/route.js?__next_edge_ssr_entry__\";\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule);\n\n//# sourceMappingURL=edge-app-route.js.map","import { neon } from '@neondatabase/serverless';\r\n\r\n// Get the database connection\r\nexport function getDb() {\r\n  if (!process.env.DATABASE_URL) {\r\n    throw new Error('DATABASE_URL environment variable is not set');\r\n  }\r\n  return neon(process.env.DATABASE_URL);\r\n}\r\n\r\n// Initialize database tables\r\nexport async function initializeDatabase() {\r\n  const sql = getDb();\r\n  \r\n  // Create users table\r\n  await sql`\r\n    CREATE TABLE IF NOT EXISTS users (\r\n      id SERIAL PRIMARY KEY,\r\n      discord_id VARCHAR(255) UNIQUE NOT NULL,\r\n      discord_username VARCHAR(255),\r\n      callsign VARCHAR(100),\r\n      vehicle VARCHAR(100),\r\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n      last_login TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n    )\r\n  `;\r\n  \r\n  // Create eprf_records table (main ePRF tracking)\r\n  await sql`\r\n    CREATE TABLE IF NOT EXISTS eprf_records (\r\n      id SERIAL PRIMARY KEY,\r\n      incident_id VARCHAR(255) NOT NULL,\r\n      patient_letter CHAR(1) NOT NULL,\r\n      status VARCHAR(20) DEFAULT 'incomplete',\r\n      author_discord_id VARCHAR(255) NOT NULL,\r\n      author_callsign VARCHAR(100),\r\n      fleet_id VARCHAR(100),\r\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n      submitted_at TIMESTAMP,\r\n      UNIQUE(incident_id, patient_letter)\r\n    )\r\n  `;\r\n  \r\n  // Create eprf_data table (stores all form data as JSON)\r\n  await sql`\r\n    CREATE TABLE IF NOT EXISTS eprf_data (\r\n      id SERIAL PRIMARY KEY,\r\n      incident_id VARCHAR(255) NOT NULL,\r\n      patient_letter CHAR(1) NOT NULL,\r\n      section VARCHAR(50) NOT NULL,\r\n      data JSONB NOT NULL,\r\n      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n      UNIQUE(incident_id, patient_letter, section)\r\n    )\r\n  `;\r\n  \r\n  // Create indexes for faster queries\r\n  await sql`CREATE INDEX IF NOT EXISTS idx_eprf_records_author ON eprf_records(author_discord_id)`;\r\n  await sql`CREATE INDEX IF NOT EXISTS idx_eprf_records_status ON eprf_records(status)`;\r\n  await sql`CREATE INDEX IF NOT EXISTS idx_eprf_data_incident ON eprf_data(incident_id, patient_letter)`;\r\n  \r\n  return { success: true };\r\n}\r\n\r\n// ePRF Record operations\r\nexport async function createEPRFRecord(\r\n  incidentId: string,\r\n  patientLetter: string,\r\n  authorDiscordId: string,\r\n  authorCallsign: string,\r\n  fleetId: string\r\n) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    INSERT INTO eprf_records (incident_id, patient_letter, author_discord_id, author_callsign, fleet_id)\r\n    VALUES (${incidentId}, ${patientLetter}, ${authorDiscordId}, ${authorCallsign}, ${fleetId})\r\n    ON CONFLICT (incident_id, patient_letter) \r\n    DO UPDATE SET updated_at = CURRENT_TIMESTAMP\r\n    RETURNING *\r\n  `;\r\n  \r\n  return result[0];\r\n}\r\n\r\nexport async function getEPRFRecord(incidentId: string, patientLetter: string) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    SELECT * FROM eprf_records \r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n  `;\r\n  \r\n  return result[0] || null;\r\n}\r\n\r\nexport async function getEPRFRecordsByUser(discordId: string) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    SELECT * FROM eprf_records \r\n    WHERE author_discord_id = ${discordId}\r\n    ORDER BY created_at DESC\r\n  `;\r\n  \r\n  return result;\r\n}\r\n\r\nexport async function getEPRFRecordsByStatus(discordId: string, status: string) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    SELECT * FROM eprf_records \r\n    WHERE author_discord_id = ${discordId} AND status = ${status}\r\n    ORDER BY created_at DESC\r\n  `;\r\n  \r\n  return result;\r\n}\r\n\r\nexport async function markEPRFComplete(incidentId: string, patientLetter: string) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    UPDATE eprf_records \r\n    SET status = 'complete', submitted_at = CURRENT_TIMESTAMP, updated_at = CURRENT_TIMESTAMP\r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n    RETURNING *\r\n  `;\r\n  \r\n  return result[0];\r\n}\r\n\r\nexport async function deleteEPRFRecord(incidentId: string, patientLetter: string) {\r\n  const sql = getDb();\r\n  \r\n  // Delete data first (foreign key would normally handle this)\r\n  await sql`\r\n    DELETE FROM eprf_data \r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n  `;\r\n  \r\n  // Then delete the record\r\n  const result = await sql`\r\n    DELETE FROM eprf_records \r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n    AND status = 'incomplete'\r\n    RETURNING *\r\n  `;\r\n  \r\n  return result[0] || null;\r\n}\r\n\r\nexport async function transferEPRF(\r\n  incidentId: string,\r\n  patientLetter: string,\r\n  newAuthorDiscordId: string,\r\n  newAuthorCallsign: string\r\n) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    UPDATE eprf_records \r\n    SET author_discord_id = ${newAuthorDiscordId}, \r\n        author_callsign = ${newAuthorCallsign},\r\n        updated_at = CURRENT_TIMESTAMP\r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n    RETURNING *\r\n  `;\r\n  \r\n  return result[0];\r\n}\r\n\r\n// ePRF Data operations (form data)\r\nexport async function saveEPRFData(\r\n  incidentId: string,\r\n  patientLetter: string,\r\n  section: string,\r\n  data: any\r\n) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    INSERT INTO eprf_data (incident_id, patient_letter, section, data)\r\n    VALUES (${incidentId}, ${patientLetter}, ${section}, ${JSON.stringify(data)})\r\n    ON CONFLICT (incident_id, patient_letter, section) \r\n    DO UPDATE SET data = ${JSON.stringify(data)}, updated_at = CURRENT_TIMESTAMP\r\n    RETURNING *\r\n  `;\r\n  \r\n  return result[0];\r\n}\r\n\r\nexport async function getEPRFData(incidentId: string, patientLetter: string, section: string) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    SELECT data FROM eprf_data \r\n    WHERE incident_id = ${incidentId} \r\n    AND patient_letter = ${patientLetter} \r\n    AND section = ${section}\r\n  `;\r\n  \r\n  return result[0]?.data || null;\r\n}\r\n\r\nexport async function getAllEPRFData(incidentId: string, patientLetter: string) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    SELECT section, data FROM eprf_data \r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n  `;\r\n  \r\n  // Convert to object with section names as keys\r\n  const dataObj: { [key: string]: any } = {};\r\n  for (const row of result) {\r\n    dataObj[row.section] = row.data;\r\n  }\r\n  \r\n  return dataObj;\r\n}\r\n\r\n// User operations\r\nexport async function upsertUser(\r\n  discordId: string,\r\n  discordUsername: string,\r\n  callsign: string,\r\n  vehicle: string\r\n) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    INSERT INTO users (discord_id, discord_username, callsign, vehicle, last_login)\r\n    VALUES (${discordId}, ${discordUsername}, ${callsign}, ${vehicle}, CURRENT_TIMESTAMP)\r\n    ON CONFLICT (discord_id) \r\n    DO UPDATE SET \r\n      discord_username = ${discordUsername},\r\n      callsign = ${callsign},\r\n      vehicle = ${vehicle},\r\n      last_login = CURRENT_TIMESTAMP\r\n    RETURNING *\r\n  `;\r\n  \r\n  return result[0];\r\n}\r\n\r\nexport async function getActiveUsers() {\r\n  const sql = getDb();\r\n  \r\n  // Get users who logged in within the last 24 hours\r\n  const result = await sql`\r\n    SELECT * FROM users \r\n    WHERE last_login > NOW() - INTERVAL '24 hours'\r\n    ORDER BY last_login DESC\r\n  `;\r\n  \r\n  return result;\r\n}\r\n\r\nexport async function getUser(discordId: string) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    SELECT * FROM users WHERE discord_id = ${discordId}\r\n  `;\r\n  \r\n  return result[0] || null;\r\n}\r\n\r\n// Search and filter ePRFs\r\nexport async function searchEPRFs(\r\n  discordId: string,\r\n  query?: string,\r\n  status?: string,\r\n  dateFrom?: string,\r\n  dateTo?: string\r\n) {\r\n  const sql = getDb();\r\n  \r\n  let result;\r\n  \r\n  if (status && status !== 'all') {\r\n    if (query) {\r\n      result = await sql`\r\n        SELECT * FROM eprf_records \r\n        WHERE author_discord_id = ${discordId}\r\n        AND status = ${status}\r\n        AND (incident_id ILIKE ${'%' + query + '%'} OR patient_letter ILIKE ${'%' + query + '%'})\r\n        ORDER BY created_at DESC\r\n      `;\r\n    } else {\r\n      result = await sql`\r\n        SELECT * FROM eprf_records \r\n        WHERE author_discord_id = ${discordId}\r\n        AND status = ${status}\r\n        ORDER BY created_at DESC\r\n      `;\r\n    }\r\n  } else {\r\n    if (query) {\r\n      result = await sql`\r\n        SELECT * FROM eprf_records \r\n        WHERE author_discord_id = ${discordId}\r\n        AND (incident_id ILIKE ${'%' + query + '%'} OR patient_letter ILIKE ${'%' + query + '%'})\r\n        ORDER BY created_at DESC\r\n      `;\r\n    } else {\r\n      result = await sql`\r\n        SELECT * FROM eprf_records \r\n        WHERE author_discord_id = ${discordId}\r\n        ORDER BY created_at DESC\r\n      `;\r\n    }\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n// Admin functions - get ALL ePRF records\r\nexport async function getAllEPRFRecords(\r\n  query?: string,\r\n  status?: string,\r\n  authorId?: string\r\n) {\r\n  const sql = getDb();\r\n  \r\n  let result;\r\n  \r\n  // Build query based on filters\r\n  if (authorId && status && status !== 'all') {\r\n    if (query) {\r\n      result = await sql`\r\n        SELECT r.*, u.callsign as user_callsign, u.discord_username \r\n        FROM eprf_records r\r\n        LEFT JOIN users u ON r.author_discord_id = u.discord_id\r\n        WHERE r.author_discord_id = ${authorId}\r\n        AND r.status = ${status}\r\n        AND (r.incident_id ILIKE ${'%' + query + '%'} OR r.patient_letter ILIKE ${'%' + query + '%'} OR r.author_callsign ILIKE ${'%' + query + '%'})\r\n        ORDER BY r.created_at DESC\r\n      `;\r\n    } else {\r\n      result = await sql`\r\n        SELECT r.*, u.callsign as user_callsign, u.discord_username \r\n        FROM eprf_records r\r\n        LEFT JOIN users u ON r.author_discord_id = u.discord_id\r\n        WHERE r.author_discord_id = ${authorId}\r\n        AND r.status = ${status}\r\n        ORDER BY r.created_at DESC\r\n      `;\r\n    }\r\n  } else if (authorId) {\r\n    if (query) {\r\n      result = await sql`\r\n        SELECT r.*, u.callsign as user_callsign, u.discord_username \r\n        FROM eprf_records r\r\n        LEFT JOIN users u ON r.author_discord_id = u.discord_id\r\n        WHERE r.author_discord_id = ${authorId}\r\n        AND (r.incident_id ILIKE ${'%' + query + '%'} OR r.patient_letter ILIKE ${'%' + query + '%'} OR r.author_callsign ILIKE ${'%' + query + '%'})\r\n        ORDER BY r.created_at DESC\r\n      `;\r\n    } else {\r\n      result = await sql`\r\n        SELECT r.*, u.callsign as user_callsign, u.discord_username \r\n        FROM eprf_records r\r\n        LEFT JOIN users u ON r.author_discord_id = u.discord_id\r\n        WHERE r.author_discord_id = ${authorId}\r\n        ORDER BY r.created_at DESC\r\n      `;\r\n    }\r\n  } else if (status && status !== 'all') {\r\n    if (query) {\r\n      result = await sql`\r\n        SELECT r.*, u.callsign as user_callsign, u.discord_username \r\n        FROM eprf_records r\r\n        LEFT JOIN users u ON r.author_discord_id = u.discord_id\r\n        WHERE r.status = ${status}\r\n        AND (r.incident_id ILIKE ${'%' + query + '%'} OR r.patient_letter ILIKE ${'%' + query + '%'} OR r.author_callsign ILIKE ${'%' + query + '%'})\r\n        ORDER BY r.created_at DESC\r\n      `;\r\n    } else {\r\n      result = await sql`\r\n        SELECT r.*, u.callsign as user_callsign, u.discord_username \r\n        FROM eprf_records r\r\n        LEFT JOIN users u ON r.author_discord_id = u.discord_id\r\n        WHERE r.status = ${status}\r\n        ORDER BY r.created_at DESC\r\n      `;\r\n    }\r\n  } else {\r\n    if (query) {\r\n      result = await sql`\r\n        SELECT r.*, u.callsign as user_callsign, u.discord_username \r\n        FROM eprf_records r\r\n        LEFT JOIN users u ON r.author_discord_id = u.discord_id\r\n        WHERE r.incident_id ILIKE ${'%' + query + '%'} OR r.patient_letter ILIKE ${'%' + query + '%'} OR r.author_callsign ILIKE ${'%' + query + '%'}\r\n        ORDER BY r.created_at DESC\r\n      `;\r\n    } else {\r\n      result = await sql`\r\n        SELECT r.*, u.callsign as user_callsign, u.discord_username \r\n        FROM eprf_records r\r\n        LEFT JOIN users u ON r.author_discord_id = u.discord_id\r\n        ORDER BY r.created_at DESC\r\n      `;\r\n    }\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n// Admin: Get all users\r\nexport async function getAllUsers() {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    SELECT * FROM users \r\n    ORDER BY last_login DESC\r\n  `;\r\n  \r\n  return result;\r\n}\r\n\r\n// Admin: Force delete any ePRF (even complete ones)\r\nexport async function adminDeleteEPRFRecord(incidentId: string, patientLetter: string) {\r\n  const sql = getDb();\r\n  \r\n  // Delete data first\r\n  await sql`\r\n    DELETE FROM eprf_data \r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n  `;\r\n  \r\n  // Then delete the record (no status check)\r\n  const result = await sql`\r\n    DELETE FROM eprf_records \r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n    RETURNING *\r\n  `;\r\n  \r\n  return result[0] || null;\r\n}\r\n\r\n// Admin: Update ePRF record\r\nexport async function adminUpdateEPRFRecord(\r\n  incidentId: string, \r\n  patientLetter: string,\r\n  updates: {\r\n    status?: string;\r\n    author_discord_id?: string;\r\n    author_callsign?: string;\r\n  }\r\n) {\r\n  const sql = getDb();\r\n  \r\n  const result = await sql`\r\n    UPDATE eprf_records \r\n    SET \r\n      status = COALESCE(${updates.status}, status),\r\n      author_discord_id = COALESCE(${updates.author_discord_id}, author_discord_id),\r\n      author_callsign = COALESCE(${updates.author_callsign}, author_callsign),\r\n      updated_at = CURRENT_TIMESTAMP\r\n    WHERE incident_id = ${incidentId} AND patient_letter = ${patientLetter}\r\n    RETURNING *\r\n  `;\r\n  \r\n  return result[0];\r\n}\r\n"],"names":["module","exports","require","runtime","GET","request","searchParams","URL","url","discordId","get","incidentId","patientLetter","query","status","record","getEPRFRecord","Response","json","success","error","records","searchEPRFs","console","message","POST","authorDiscordId","authorCallsign","fleetId","createEPRFRecord","PUT","action","newAuthorDiscordId","newAuthorCallsign","markEPRFComplete","transferEPRF","DELETE","deleteEPRFRecord","routeModule","module_compiled","AppRouteRouteModule","definition","kind","route_kind","x","APP_ROUTE","page","pathname","filename","bundlePath","resolvedPagePath","nextConfigOutput","userland","route_namespaceObject","requestAsyncStorage","staticGenerationAsyncStorage","serverHooks","originalPathname","patchFetch","patch_fetch","XH","ComponentMod","route_next_edge_ssr_entry_namespaceObject","next_edge_app_route_loaderabsolutePagePath_private_next_app_dir_2Fapi_2Feprf_2Frecords_2Froute_js_page_2Fapi_2Feprf_2Frecords_2Froute_appDirLoader_bmV4dC1hcHAtbG9hZGVyP25hbWU9YXBwJTJGYXBpJTJGZXByZiUyRnJlY29yZHMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmVwcmYlMkZyZWNvcmRzJTJGcm91dGUmcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZlcHJmJTJGcmVjb3JkcyUyRnJvdXRlLmpzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNUb2J5JTVDRG93bmxvYWRzJTVDbm9kZS12MjQuMTEuMS13aW4teDY0JTVDYXBwMTIzJTVDYXBwJmFwcFBhdGhzPSUyRmFwaSUyRmVwcmYlMkZyZWNvcmRzJTJGcm91dGUmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0Qh_nextConfigOutput_preferredRegion_middlewareConfig_e30_3D_","edge_route_module_wrapper","a","wrap","getDb","process","env","DATABASE_URL","neon","initializeDatabase","sql","result","saveEPRFData","section","data","JSON","stringify","getEPRFData","getAllEPRFData","dataObj","row","upsertUser","discordUsername","callsign","vehicle","getActiveUsers","getUser","dateFrom","dateTo","getAllEPRFRecords","authorId","getAllUsers","adminDeleteEPRFRecord","adminUpdateEPRFRecord","updates","author_discord_id","author_callsign"],"sourceRoot":""}